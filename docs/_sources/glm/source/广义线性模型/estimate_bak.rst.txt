
########################################################
GLMçš„å‚æ•°ä¼°è®¡
########################################################


æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»ä¸¤ç§GLMæ¨¡å‹çš„å‚æ•°ä¼°è®¡ç®—æ³•ï¼Œ
æˆ‘ä»¬å°†ç»Ÿä¸€çš„ä»¥æŒ‡æ•°æ—çš„å½¢å¼å±•ç°ç®—æ³•è¿‡ç¨‹ï¼Œè¿™æ ·é€‚ç”¨äºæŒ‡æ•°æ—ä¸­çš„æ‰€æœ‰å…·ä½“åˆ†å¸ƒï¼Œ
æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©å¤§å®¶å¯¹GLMçš„åŸºç¡€ç†è®ºæœ‰ä¸ªå…¨é¢çš„äº†è§£ï¼ŒåŒæ—¶æˆ‘ä»¬ä¼šç€é‡å¼ºè°ƒç®—æ³•æˆç«‹çš„å‡è®¾åŠå…¶ä¸€äº›é™åˆ¶ã€‚


ä¼ ç»Ÿä¸Šï¼Œå¯¹äºå•å‚æ•°çš„æŒ‡æ•°æ—åˆ†å¸ƒå¯ä»¥è¿ç”¨æ¢¯åº¦ä¸‹é™æ³•å’Œç‰›é¡¿æ³•è¿›è¡Œå‚æ•°ä¼°è®¡ï¼Œ
æ¢¯åº¦ä¸‹é™æ³•çš„ä¼˜ç‚¹æ˜¯ç®—æ³•å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯æ”¶æ•›é€Ÿåº¦ä¸å¦‚ç‰›é¡¿æ³•ã€‚
æ¢¯åº¦ä¸‹é™æ³•å’Œç‰›é¡¿æ³•åœ¨å½¢å¼ä¸Šæ˜¯éå¸¸ç›¸ä¼¼çš„ï¼ŒäºŒè€…éƒ½æ˜¯æ²¿ç€ç›®æ ‡å‡½æ•°çš„è´Ÿæ¢¯åº¦æ–¹å‘å¯»æ‰¾æœ€ä¼˜è§£ï¼Œ
ä¸åŒçš„æ˜¯ä¼ ç»Ÿæ¢¯åº¦ä¸‹é™æ³•åˆ©ç”¨ä¸€é˜¶å¯¼æ•°ï¼Œè€Œç‰›é¡¿æ³•åˆ©ç”¨äºŒé˜¶å¯¼æ•°ï¼Œç‰›é¡¿æ³•ç›¸å¯¹äºæ¢¯åº¦ä¸‹é™æ³•æ”¶æ•›é€Ÿåº¦ä¼šæ›´å¿«ï¼Œ
ä½†æ˜¯ç”±äºäºŒé˜¶å¯¼æ•°çš„å¼•å…¥ä¹Ÿä½¿å¾—ç‰›é¡¿æ³•çš„è®¡ç®—å¤æ‚åº¦å¢åŠ å¾ˆå¯¹ï¼Œç”šè‡³å¾ˆå¤šæ—¶å€™æ— æ³•è®¡ç®—ã€‚
åœ¨ç”¨ç‰›é¡¿æ³•å¯¹æŒ‡æ•°æ—æ¨¡å‹è¿›è¡Œå‚æ•°ä¼°è®¡æ—¶ï¼Œä¸åŒçš„åˆ†å¸ƒæ‹¥æœ‰ä¸åŒçš„æ¢¯åº¦è¡¨è¾¾å¼ï¼Œæ‰€ä»¥æ¯ç§åˆ†å¸ƒéƒ½éœ€å®ç°ä¸€ä¸ªé€‚åˆè‡ªå·±çš„ç‰›é¡¿æ³•ã€‚
è¿™é‡Œæˆ‘ä»¬åŒæ—¶ä¼šä»‹ç»ç‰›é¡¿æ³•çš„ä¸€ä¸ªå˜ç§ç®—æ³•ï¼Œè¿­ä»£é‡åŠ æƒæœ€å°å¹³æ–¹æ³•(iteratively reweighted least squares,IRLS)ã€‚
GLMæ¡†æ¶ä¸‹çš„æ¨¡å‹éƒ½å¯ä»¥ä»¥ç»Ÿè®¡çš„å½¢å¼è¿ç”¨IRLSç®—æ³•è¿›è¡Œå‚æ•°ä¼°è®¡ï¼Œè¿™æ˜¯GLMéå¸¸æœ‰å¸å¼•åŠ›çš„ä¸€ç‚¹ã€‚
IRLS ç®—æ³•çš„å¦ä¸€ä¸ªç‰¹ç‚¹æ˜¯ä¸éœ€è¦å¯¹ä¼°è®¡å‚æ•° :math:`\hat{\beta}` è¿›è¡Œåˆå§‹åŒ–è®¾ç½®ã€‚

.. _ch_glm_estimate:

æœ€å¤§ä¼¼ç„¶ä¼°è®¡
######################################
æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ˜¯åº”ç”¨ååˆ†å¹¿æ³›çš„ä¸€ç§å‚æ•°ä¼°è®¡æ–¹æ³•ï¼Œ
å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æå¤§åŒ–æœ€å¤§ä¼¼ç„¶å‡½æ•°æ‰¾åˆ°å‚æ•°çš„æœ€ä¼˜è§£ï¼Œ
GLMä¸­å‚æ•°ä¼°è®¡å°±æ˜¯ä½¿ç”¨çš„æœ€å¤§ä¼¼ç„¶æ–¹æ³•ã€‚
æ³¨æ„åœ¨GLMä¸­ï¼Œæœ€å¤§ä¼¼ç„¶æ–¹æ³•ä¸èƒ½åŒæ—¶ä¼°è®¡çº¿æ€§åå˜é‡å‚æ•° :math:`\beta` å’Œåˆ†æ•£å‚æ•°
:math:`\phi` ï¼Œ
åœ¨GLMä¸­çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡é€šå¸¸æ˜¯å‡è®¾åˆ†æ•£å‚æ•° :math:`\phi` å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œ
ä¼°è®¡åå˜é‡å‚æ•° :math:`\beta` ã€‚

å‡è®¾å“åº”å˜é‡ :math:`Y` æ˜¯GLMä¸­çš„æŒ‡æ•°æ—åˆ†å¸ƒï¼Œ
åå˜é‡ :math:`X` å’Œå“åº”å˜é‡ :math:`Y` çš„ä¸€ä¸ªæ ·æœ¬é›†ä¸º :math:`\mathcal{D}=\{(x_1,y_1),(x_2,y_2),\dots,(x_N,y_N)\}`
ï¼Œæ ·æœ¬ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæœ¬ä¹¦ä¸­çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡éƒ½æ˜¯å»ºç«‹åœ¨æ ·æœ¬ç‹¬ç«‹çš„å‡è®¾ä¹‹ä¸Šã€‚
æ‰€æœ‰æ ·æœ¬çš„è”åˆæ¦‚ç‡ä¸º

.. math::
    :label: eq_34_21

    f(y;\theta,\phi)=\prod_{i=1}^N f(y_i;\theta,\phi)

:math:`\theta` æ˜¯æŒ‡æ•°æ—åˆ†å¸ƒçš„è‡ªç„¶å‚æ•°ï¼Œ:math:`\phi`
æ˜¯åˆ†æ•£å‚æ•°ã€‚
æ ·æœ¬çš„è”åˆæ¦‚ç‡åˆè¢«ç§°ä¸ºæ ·æœ¬é›†çš„ä¼¼ç„¶å‡½æ•°ï¼Œ

.. math::
    :label: eq_34_22


    L(\theta,\phi;y)=\prod_{i=1}^N f(\theta,\phi;y_i)


:eq:`eq_34_21` å’Œ :eq:`eq_34_22` çš„åŒºåˆ«åœ¨äºï¼Œ
å‰è€…æ˜¯ä¸€ä¸ªæ¦‚ç‡å¯†åº¦(è´¨é‡)å‡½æ•°ï¼Œæ˜¯åœ¨ç»™å®š :math:`\theta,\phi` çš„æ¡ä»¶ä¸‹å…³å˜é‡ :math:`Y` çš„å‡½æ•°ï¼›
åè€…æ˜¯ä¸€ä¸ªä¼¼ç„¶å‡½æ•°ï¼Œå…¶è¡¨è¾¾æ˜¯åœ¨ç»™å®šè§‚æµ‹æ ·æœ¬ :math:`y` çš„æ¡ä»¶ä¸‹å…³äºæœªçŸ¥å‚æ•° :math:`\theta,\phi` çš„å‡½æ•°ã€‚

å› ä¸ºä¼¼ç„¶å‡½æ•°æ˜¯ä¸€ä¸ªè¿ä¹˜å½¢å¼ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬ä¼šå¯¹å…¶è¿›è¡Œä¸€ä¸ªå¯¹æ•°è½¬æ¢(log-transform)è¿›è€Œå¾—åˆ°ä¸€ä¸ªè¿åŠ çš„å½¢å¼ï¼Œ
è¿åŠ çš„å½¢å¼æ›´æ–¹ä¾¿è¿›è¡Œè®¡ç®—ã€‚
è¿ä¹˜å˜æˆè¿åŠ æœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œ(1)æ›´å®¹æ˜“æ±‚å¯¼å’Œæå¤§åŒ–æ“ä½œï¼›(2)ä¼¼ç„¶å‡½æ•°æ˜¯æ¦‚ç‡è¿ä¹˜ï¼Œè€Œæ¦‚ç‡éƒ½æ˜¯å°äº1çš„ï¼Œå¤§é‡å°äº1çš„æ•°å­—è¿ä¹˜äº§ç”Ÿæ›´å°çš„æ•°å­—ï¼Œ
ç”šè‡³è¶‹è¿‘äº0ï¼Œè€Œè®¡ç®—æœºçš„æµ®ç‚¹æ•°ç²¾åº¦æ˜¯é€šå¸¸æ— æ³•å¤„ç†è¿™ä¹ˆå°çš„æ•°å­—çš„ï¼Œæ‰€ä»¥åŠ å¯¹æ•°æ›´æ–¹ä¾¿è®¡ç®—æœºè¿›è¡Œæ•°å€¼å¤„ç†ã€‚


åŠ äº†å¯¹æ•°çš„ä¼¼ç„¶å‡½æ•°è¢«ç§°ä¸ºå¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼Œé€šå¸¸ç”¨ç¬¦å· :math:`\ell`
è¡¨ç¤ºï¼Œå¯¹æ•°ä¼¼ç„¶å‡½æ•°æ˜¯æœ€å¤§ä¼¼ç„¶ä¼°è®¡(ML)çš„æ ¸å¿ƒï¼Œ
GLMæ¨¡å‹çš„å¯¹æ•°ä¼¼ç„¶ä¼°è®¡å‡½æ•°ä¸ºï¼š


.. math::


    \ell(\theta,\phi;y)= \sum_{i=1}^N \left \{   \frac{y_i \theta_i - b(\theta_i)}{a(\phi)}   + c(y_i,\phi)   \right \}


:math:`\theta_i` æ˜¯è‡ªç„¶å‚æ•°ï¼Œ
:math:`b(\theta_i)` æ˜¯ç´¯ç§¯å‡½æ•°ï¼Œå®ƒæè¿°çš„æ˜¯åˆ†å¸ƒçš„çŸ©(moment)ï¼›
:math:`\phi` æ˜¯åˆ†æ•£å‚æ•°(dispersion parameter)ï¼Œå®ƒæ˜¯æ¯”ä¾‹æˆ–è¾…åŠ©å‚æ•°ï¼›
:math:`c(\cdot)` æ˜¯å½’ä¸€åŒ–é¡¹ã€‚
å½’ä¸€åŒ–é¡¹ä¸æ˜¯ :math:`\theta` çš„å‡½æ•°ï¼Œè€Œæ˜¯ç®€å•åœ°ç¼©æ”¾åŸºç¡€å¯†åº¦å‡½æ•°çš„èŒƒå›´ä½¿å¾—æ•´ä¸ªå‡½æ•°çš„ç§¯åˆ†ï¼ˆæˆ–æ±‚å’Œï¼‰ä¸º1ã€‚
åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬è®¨è®ºè¿‡ï¼ŒæŒ‡æ•°æ—åˆ†å¸ƒçš„æœŸæœ›ä¸æ–¹å·®å¯ä»¥é€šè¿‡ :math:`b(\theta)` çš„å¯¼æ•°æ±‚å¾—ã€‚


.. math::

     \mu &= \mathbb{E}[Y] = b'(\theta)

     Var(Y) &= b''(\theta) a(\phi)

å¹¶ä¸”æˆ‘ä»¬çŸ¥é“ï¼Œå‡å€¼å‚æ•° :math:`\mu` å’Œè‡ªç„¶å‚æ•° :math:`\theta` æ˜¯å­˜åœ¨ä¸€ä¸ªå¯é€†çš„å‡½æ•°å…³ç³»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´
:math:`\mu` å¯ä»¥çœ‹åšæ˜¯å…³äº :math:`\theta` çš„ä¸€ä¸ªå‡½æ•°ï¼Œåä¹‹ï¼Œ:math:`\theta` ä¹Ÿå¯çœ‹åšæ˜¯ä¸€ä¸ªå…³äº
:math:`\mu` çš„å‡½æ•°ã€‚
åŸºäºè¿™ä¸ªäº‹å®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ :math:`b''(\theta)` çœ‹åšæ˜¯ä¸€ä¸ªå…³äº :math:`\mu` çš„å‡½æ•°ï¼Œè®°ä½œ
:math:`\nu(\mu)` ã€‚


.. math::

     b''(\theta) \triangleq \nu(\mu)

å› æ­¤ï¼Œæ–¹å·® :math:`Var(Y)` å°±å¯ä»¥è¢«çœ‹æˆæ˜¯å‡½æ•° :math:`\nu(\mu)`
å’Œåˆ†æ•£å‡½æ•° :math:`a(\phi)` çš„ä¹˜ç§¯ï¼Œé€šå¸¸æˆ‘ä»¬æŠŠ :math:`\nu(\mu)=b''(\theta)` ç§°ä¸ºæ–¹å·®å‡½æ•°(variance function)ï¼Œ
**æ³¨æ„ï¼šè™½ç„¶å«æ–¹å·®å‡½æ•°ï¼Œä½†æ–¹å·®å‡½æ•°çš„å€¼ä¸æ˜¯æ–¹å·®æœ¬èº«ã€‚**
æœ‰æ—¶ :math:`b''(\theta)` ä¼šæ˜¯ä¸€ä¸ªå¸¸æ•°é‡(constant)ï¼Œæ¯”å¦‚é«˜æ–¯åˆ†å¸ƒï¼Œæ­¤æ—¶åˆ†å¸ƒçš„æ–¹å·®ä¸ºï¼š

.. math::

    Var(Y)=constant \times a(\phi)

è¿™æ—¶ï¼Œåˆ†å¸ƒçš„æ–¹å·®å°±ä¸ä¼šå—åˆ°å‡å€¼çš„å½±å“äº†ã€‚
å¦å¤–æ–¹å·®å‡½æ•° :math:`\nu(\mu)` å¯ä»¥é€šè¿‡ç®€å•æ–¹å¼æ±‚å¾—ã€‚

.. math::

    \nu(\mu) = b''(\theta) =(b'(\theta))'= (\mu(\theta))' = \frac{\partial \mu}{\partial \theta}


æ˜¾ç„¶ï¼Œå½“ :math:`\mu` ä¸ :math:`\theta` ä¹‹é—´çš„æ˜ å°„å‡½æ•°æ˜¯çº¿æ€§å‡½æ•°æ—¶ï¼Œä¸€é˜¶åå¯¼ :math:`\frac{\partial \mu}{\partial \theta}`
å°±æ˜¯ä¸€ä¸ªå¸¸æ•°å€¼ã€‚å¦å¤–ï¼Œæˆ‘ä»¬çŸ¥é“åå‡½æ•°çš„å¯¼æ•°å°±ç­‰äºåŸå‡½æ•°å¯¼æ•°çš„å€’æ•°ï¼Œæ‰€ä»¥æœ‰ï¼š

.. math::

    \frac{\partial \theta}{\partial \mu} = \frac{1}{\nu(\mu)}



åœ¨GLMæ¡†æ¶ä¸‹ï¼Œè¾“å…¥å˜é‡ :math:`X` å’Œå…¶ç³»æ•° :math:`\beta`
ç»„æˆä¸€ä¸ªçº¿æ€§é¢„æµ‹å™¨ :math:`\eta=\beta^Tx` ã€‚
:math:`\eta` å’Œåˆ†å¸ƒçš„å‡å€¼(æœŸæœ›)é€šè¿‡è¿æ¥å‡½æ•°(å·²çŸ¥çš„)è¿æ¥åœ¨ä¸€èµ· ã€‚

.. math::


    \eta &=\beta^Tx = g(\mu)

    \mu &= g^{-1}(\eta)


å…¶ä¸­ :math:`\beta` å’Œ :math:`x` éƒ½æ˜¯ä¸€ä¸ªå‘é‡ï¼Œ:math:`\beta^Tx = \sum_j \beta_j x_j` ï¼Œ
å› æ­¤æœ‰ï¼š

.. math::

    \frac{\partial \eta_i}{\partial \beta_j} = x_{ij}



çº¿æ€§é¢„æµ‹å™¨ :math:`\eta` çš„å€¼ç©ºé—´å¹¶æ²¡æœ‰ç‰¹åˆ«çš„é™å®šï¼Œ
å…¶å€¼ç©ºé—´æ˜¯æ•´ä¸ªå®æ•°åŸŸ :math:`\eta \in R` ã€‚
è€Œ :math:`\mu` çš„å–å€¼èŒƒå›´æ˜¯ç‰¹å®šåˆ†å¸ƒç›¸å…³çš„ï¼Œ
ä¸åŒæŒ‡æ•°æ—åˆ†å¸ƒï¼Œ:math:`\mu` çš„å–å€¼èŒƒå›´æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚é«˜æ–¯åˆ†å¸ƒ :math:`\mu \in R`
ï¼ŒäºŒé¡¹åˆ†å¸ƒ :math:`\mu \in [0,1]` ã€‚
**å› æ­¤ï¼Œè¿æ¥å‡½æ•°çš„ä¸€ä¸ªç›®çš„å°±æ˜¯å°†çº¿æ€§é¢„æµ‹å™¨çš„å€¼æ˜ å°„åˆ°å“åº”å˜é‡æœŸæœ›å‚æ•°çš„èŒƒå›´ã€‚**


ç°åœ¨è®©æˆ‘ä»¬å›åˆ°æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„æ€æƒ³æ˜¯ä½¿å¾—ä¼¼ç„¶å‡½æ•°å–å¾—æœ€å¤§å€¼çš„å‚æ•°å€¼ä¸ºæ¨¡å‹çš„æœ€ä¼˜è§£ã€‚
æ ¹æ®å¾®åˆ†ç†è®ºï¼Œå‡½æ•°å–å¾—æå€¼çš„ç‚¹å…¶ä¸€é˜¶åå¯¼æ•°ä¸º0ï¼Œç„¶è€Œå¯¼æ•°ä¸º0çš„ç‚¹ä¸ä¸€å®šæ˜¯æœ€å¤§å€¼çš„ç‚¹ï¼Œä¹Ÿå¯èƒ½æ˜¯é©»ç‚¹ã€æœ€å°å€¼ç‚¹ï¼Œ
æ‰€ä»¥æœ€å¤§ä¼¼ç„¶ä¼°è®¡è¦æ±‚ä¼¼ç„¶å‡½æ•°æœ€å¥½æ˜¯å‡¹å‡½æ•°ã€‚
æ³¨æ„ï¼Œå‚æ•° :math:`\beta` æ˜¯ä¸€ä¸ªå‘é‡ï¼Œæ‰€ä»¥æ±‚å¾—æ˜¯åå¯¼æ•°ï¼Œ
åˆ©ç”¨æ±‚å¯¼çš„é“¾å¼æ³•åˆ™å¯¹GLMæ¨¡å‹çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°è¿›è¡Œæ±‚å¯¼ã€‚


.. math::
    :label: eq_34_jac


    \frac{ \partial \ell}{\beta_j} &= \sum_{i=1}^N \left ( \frac{\partial \ell_i}{\partial \theta_i} \right )
    \left ( \frac{\partial \theta_i}{\partial \mu_i} \right )
    \left ( \frac{\partial \mu_i}{\partial \eta_i} \right )
    \left ( \frac{\partial \eta_i}{\partial \beta_j} \right )

    &= \sum_{i=1}^N \left \{ \frac{y_i-b'(\beta_i)}{a(\phi)}   \right \}
    \left \{ \frac{1}{\nu(\mu_i)} \right \} \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}

    &= \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}



å…¶ä¸­ :math:`i` æ˜¯è§‚æµ‹æ ·æœ¬çš„ç¼–å·ï¼Œ:math:`j` æ˜¯å‚æ•°å‘é‡çš„ä¸‹æ ‡ã€‚
:math:`x_{ij}` è¡¨ç¤ºç¬¬ :math:`i` æ¡è§‚æµ‹æ ·æœ¬çš„ç¬¬ :math:`j` åˆ—ç‰¹å¾å€¼ï¼Œ
:math:`y_i` æ˜¯å“åº”å˜é‡çš„è§‚æµ‹å€¼ï¼Œ:math:`a(\phi)` é€šå¸¸è®¤ä¸ºæ˜¯å·²çŸ¥çš„ã€‚
:math:`\mu_i` æ˜¯ :math:`y_i` çš„æœŸæœ›ï¼Œä¹Ÿæ˜¯æ¨¡å‹çš„é¢„æµ‹å€¼ï¼Œ
æ–¹å·®å‡½æ•° :math:`\nu(\mu_i)` æ˜¯å…³äº :math:`\mu_i` çš„å‡½æ•°ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç®—å‡ºã€‚
:math:`\frac{\partial \mu}{\partial \eta}` æ˜¯å“åº”å‡½æ•°(æˆ–è€…è¯´æ˜¯æ¿€æ´»å‡½æ•°)å…³äº :math:`\eta_i` çš„å¯¼æ•°ï¼Œ
åœ¨ç¡®å®šäº†è¿æ¥å‡½æ•°çš„å½¢å¼åä¹Ÿæ˜¯å¯ä»¥ç®—å‡ºçš„ã€‚


:eq:`eq_34_jac` æ˜¯GLMæ ‡å‡†å½¢å¼ä¸‹å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„ä¸€é˜¶åå¯¼æ•°ï¼ŒGLMæ¡†æ¶ä¸‹çš„ä»»æ„æ¨¡å‹éƒ½å¯ä»¥æŒ‰ç…§æ­¤å…¬å¼è®¡ç®—åå¯¼æ•°ï¼Œ
åªéœ€è¦æŒ‰ç…§ç‰¹å®šçš„åˆ†å¸ƒå’Œè¿æ¥å‡½æ•°æ›¿æ¢ç›¸åº”ç»„ä»¶å³å¯ã€‚


å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„ä¸€é˜¶å¯¼æ•°åˆå«åš ``Fisher score`` ï¼Œæˆ–è€…å¾—åˆ†å‡½æ•°(score function)ï¼Œ
å¸¸ç”¨ç¬¦å· :math:`U` è¡¨ç¤ºã€‚

.. math::

   U_j = \frac{\partial \ell}{\partial \beta_j}
  = \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}


:math:`U` çš„è¡¨è¾¾å¼ä¸­åªæœ‰ :math:`y_i` æ˜¯éšæœºå˜é‡çš„æ ·æœ¬ï¼Œå…¶å®ƒéƒ½æ˜¯æ•°å€¼å˜é‡ï¼Œ
:math:`U` æ˜¯ä¸€ä¸ªå…³äºæ ·æœ¬çš„å‡½æ•°ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªç»Ÿè®¡é‡(statistic)ï¼Œ
å¾—åˆ†å‡½æ•°(score function)æœ‰æ—¶ä¹Ÿå«ä½œå¾—åˆ†ç»Ÿè®¡é‡(score statistic)ï¼Œ
ç»Ÿè®¡é‡ä¹Ÿæ˜¯éšæœºå˜é‡ã€‚
æˆ‘ä»¬çŸ¥é“ :math:`\mathbb{E}[y_i]=\mu_i`ï¼Œ
è€Œç»Ÿè®¡é‡ :math:`U` æ˜¯å˜é‡ :math:`y` çš„å‡½æ•°ï¼Œå› æ­¤ :math:`U` æœŸæœ›å€¼ä¸ºï¼š

.. math::


   \mathbb{E}_{y}[U_j] &= \mathbb{E}_{y} \left [ \frac{\partial \ell}{\partial \beta_j} \right ]

   &= \mathbb{E}_{y} \left [ \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) }
         \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}  \right ]

   &= \sum_{i=1}^N \frac{ \mathbb{E}[y_i]-\mu_i}{a(\phi) \nu(\mu_i) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}


   &= 0

ç»Ÿè®¡é‡ :math:`U` çš„æ–¹å·® :math:`\mathcal{J}=\mathbb{E}\{(U-\mathbb{E}[U])(U-\mathbb{E}[U])^T \}=\mathbb{E}[UU^T]`
åˆè¢«ç§°ä¸ºè´¹å¸Œå°”ä¿¡æ¯(Fisher information)ï¼Œæˆ–è€…ä¿¡æ¯çŸ©é˜µ(information matrix)ï¼Œ

.. math::


    \mathcal{J}_{jk} &= \mathbb{E}[U_jU_k]

    &= \mathbb{E}_{y} \left [
    \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}
    \cdot
    \sum_{l=1}^N \frac{y_l-\mu_l}{a(\phi) \nu(\mu_l) } \left ( \frac{\partial \mu}{\partial \eta} \right )_l x_{lk}
    \right ]

    &= \mathbb{E}_{y} \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i
    \frac{ (y_i-\mu_i)^2}{ [a(\phi) \nu(\mu_i)]^2 }   x_{ij} x_{ik}
    + \mathbb{E}_{y} \left [
    \sum_{i=1}^N \sum_{l=1}^N   \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}
    \frac{y_l-\mu_l}{a(\phi) \nu(\mu_l) } \left ( \frac{\partial \mu}{\partial \eta} \right )_l x_{lk}
    \right ]_{l\ne i}


    &= \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i
    \frac{ \mathbb{E}_{y}[(y_i-\mu_i)^2]}{ [a(\phi) \nu(\mu_i)]^2 }
    x_{ij} x_{ik}
    +  \underbrace{\left [
    \sum_{i=1}^N \sum_{l=1}^N   \frac{ \mathbb{E}_{y}[(y_i-\mu_i)(y_l-\mu_l)]}{a(\phi)^2 \nu(\mu_i) \nu(\mu_l) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}
     \left ( \frac{\partial \mu}{\partial \eta} \right )_l x_{lk}
    \right ]_{l\ne i}}_{0}



:math:`\mathbb{E}[(y_i-\mu_i)(y_l-\mu_l)]`
æ˜¯ :math:`y_i` ä¸ :math:`y_l` çš„åæ–¹å·®ï¼Œ
æ ¹æ®æ ·æœ¬ç‹¬ç«‹æ€§å‡è®¾ :math:`y_i \perp \!\!\! \perp  y_l,\ l \ne i`
ï¼Œ:math:`y_i` ä¸ :math:`y_l` çš„åæ–¹å·®ä¸º0ï¼Œ
å› æ­¤æœ‰ :math:`\mathbb{E}[(y_i-\mu_i)(y_l-\mu_l)]=0`
ã€‚è€Œ :math:`\mathbb{E}_{y}[(y_i-\mu_i)^2]` è¡¨ç¤º :math:`y_i`
çš„æ–¹å·®ï¼Œæœ‰ :math:`\mathbb{E}_{y}[(y_i-\mu_i)^2]=Var(y_i)=a(\phi)\nu(\mu_i)`
ã€‚æœ€ç»ˆåŒ–ç®€ä¸º

.. math::
    :label: eq_glm_estimate_019

    \mathcal{J}_{jk} = \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i
    \frac{1}{ a(\phi) \nu(\mu_i) }
    x_{ij} x_{ik}




é€šè¿‡ä»¤ :math:`U=0` æ±‚å¾—å‚æ•°ä¼°è®¡å€¼ï¼Œè¿™ä¸ªç­‰å¼è¢«ç§°ä¸ºä¼°è®¡ç­‰å¼(estimating equation)ï¼Œ
æœ‰çš„èµ„æ–™ä¸­ä¹Ÿå«æ­£è§„æ–¹ç¨‹(normal equation)ã€‚

.. math::
    :label: eq_glm_estimate_020

       U_j
       = \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) }
        \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}
       = 0

å¦‚æœæ˜¯ä¼ ç»Ÿçº¿æ€§å›å½’æ¨¡å‹ï¼Œç›¸å½“äº :math:`y_i` æ˜¯é«˜æ–¯åˆ†å¸ƒ
:math:`y_i \sim \mathcal{N}(\mu_i,\sigma^2=1)`
ï¼Œè¿æ¥å‡½æ•°æ˜¯æ’ç­‰å‡½æ•° :math:`\mu_i=\eta_i`
æ­¤æ—¶ :math:`U` ä¸­çš„å‡ é¡¹éƒ½æ˜¯å¸¸é‡ã€‚

.. math::

    \frac{\partial \mu_i }{\partial \eta_i} = 1

    \nu(\mu) = 1

    a(\phi) = \sigma^2=1


æ­¤æ—¶ :math:`U_j` ç®€åŒ–ä¸º

.. math::

   U_j
   = \sum_{i=1}^N (y_i-\mu_i ) x_{ij}
   = 0

ä¸Šå¼æ˜¯å•ä¸ªå‚æ•° :math:`\beta_j` çš„å¾—åˆ†ç»Ÿè®¡é‡ :math:`U_j`
ï¼Œè½¬æˆå‘é‡ä¸º

.. math::

    \pmb{U} = (\pmb{y}-\pmb{u})^T \pmb{X}
    = (\pmb{y}- \pmb{X}\pmb{\beta})^T\pmb{X}
    = \pmb{X}^T \pmb{y} - \pmb{X}^T X \pmb{\beta}
    = \pmb{0}


ç§»é¡¹å¯è§£çš„å‚æ•°çš„ä¼°è®¡å€¼

.. math::

    \hat{\pmb{\beta}} = ( \pmb{X}^T \pmb{X})^{-1}\pmb{X}^T \pmb{y}


æˆ‘ä»¬å‘ç°æ ‡å‡†è¿æ¥å‡½æ•°çš„é«˜æ–¯æ¨¡å‹ï¼Œä¼°è®¡ç­‰å¼ :math:`U=0` å¯ä»¥å¾—åˆ°è§£æè§£ï¼Œ
åªæœ‰é‡‡ç”¨æ ‡å‡†è¿æ¥å‡½æ•°æ—¶æ‰æœ‰è¿™ä¸ªç‰¹æ€§ã€‚
GLMä¸­ï¼Œé‡‡ç”¨æ ‡å‡†è¿æ¥å‡½æ•°çš„æƒ…å†µä¸‹æœ‰ :math:`\theta=\eta`
ï¼Œæ­¤æ—¶å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„ä¸€é˜¶å¯¼æ•° :math:`U` å¯ä»¥ç®€åŒ–ã€‚

.. math::

    U_j = \frac{ \partial \ell}{\beta_j} &= \sum_{i=1}^N
    \left ( \frac{\partial \ell_i}{\partial \theta_i} \right )
    \left ( \frac{\partial \theta_i}{\partial \mu_i} \right )
    \left ( \frac{\partial \mu_i}{\partial \eta_i} \right )
    \left ( \frac{\partial \eta_i}{\partial \beta_j} \right )

    &= \sum_{i=1}^N
    \left ( \frac{\partial \ell_i}{\partial \eta_i} \right )
    \left ( \frac{\partial \eta_i}{\partial \mu_i} \right )
    \left ( \frac{\partial \mu_i}{\partial \eta_i} \right )
    \left ( \frac{\partial \eta_i}{\partial \beta_j} \right )

    &= \sum_{i=1}^N
    \left ( \frac{\partial \ell_i}{\partial \eta_i} \right )
    \left ( \frac{\partial \eta_i}{\partial \beta_j} \right )

    &= \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi)} x_{ji}

å½“é‡‡ç”¨æ ‡å‡†è¿æ¥å‡½æ•°æ—¶ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡ä»¤ä¸Šå¼ç­‰äº0æ±‚å¾—æœ€å¤§ä¼¼ç„¶ä¼°è®¡å€¼ï¼Œ
ä¸Šå¼ä¸­ :math:`\mu_i` æ˜¯æ¨¡å‹çš„è¾“å‡ºå€¼ :math:`\mu_i=x_i^T\beta=\hat{\mu}_i=\hat{y_i}`
ã€‚

æ³°å‹’çº§æ•°
############################

æœ€å¤§ä¼¼ç„¶çš„æ±‚è§£éœ€è¦æ±‚è§£æ­£è§„æ–¹ç¨‹ï¼Œ
ç„¶è€Œåœ¨GLMä¸­ï¼Œæ­£è§„æ–¹ç¨‹å¹¶ä¸æ˜¯ä¸€å®šå­˜åœ¨è§£æè§£çš„ï¼Œéœ€è¦æ»¡è¶³ä¸€äº›é™åˆ¶æ¡ä»¶æ‰è¡Œï¼Œ
è§£æè§£çš„æ–¹å¼å¹¶ä¸å…·å¤‡é€šç”¨æ€§ï¼Œæˆ‘ä»¬éœ€è¦é‡‡ç”¨æ›´ä¸€èˆ¬çš„æ–¹æ³•ï¼Œé€¼è¿‘æ³•ï¼Œä¹Ÿå«è¿­ä»£æ³•ã€‚
è¿­ä»£æ³•åˆå¯ä»¥ç®€å•åˆ†ä¸ºä¸€é˜¶å¯¼(æ¢¯åº¦ä¸‹é™æ³•ç³»åˆ—)å’ŒäºŒé˜¶å¯¼(ç‰›é¡¿æ³•ç³»åˆ—)ï¼Œå®é™…è¿™ä¸¤ç§éƒ½å¯ä»¥é€šè¿‡æ³°å‹’çº§æ•°(Taylor series)è¿›è¡Œæ¨å¯¼ã€‚
æ³°å‹’çº§æ•°æœ‰å¾ˆå¤šä¸ªåå­—ï¼Œæ³°å‹’å…¬å¼(Taylor formula)ã€æ³°å‹’çº§æ•°(Taylor series)ã€
æ³°å‹’å±•å¼€(Taylor explanation)ã€æ³°å‹’å®šç†(Taylor theory)ç­‰ï¼Œéƒ½æ˜¯ä¸€å›äº‹ã€‚







è®¾ :math:`n` æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚å¦‚æœå®šä¹‰åœ¨ä¸€ä¸ªåŒ…å« :math:`x_0` çš„åŒºé—´ä¸Šçš„å‡½æ•°fåœ¨ :math:`x_0`
å¤„ :math:`n+1` æ¬¡å¯å¯¼ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªåŒºé—´ä¸Šçš„ä»»æ„xï¼Œéƒ½æœ‰

.. math::

        f(x)_{Taylor}  &= \sum_{n=0}^{\infty} \frac{f^{(n)}(x_0)}{n!}  (x - x_0)^n

         &= f(x_0) + \frac{f'(x_0)}{1!}(x-x_0) + \frac{f^{(2)}(x_0)}{2!}(x-x_0)^2+ \cdots + \frac{f^{(n)}(x_0)}{n!}(x-x_0)^n + R_i(x)


å…¶ä¸­ :math:`f^{(n)}` è¡¨ç¤º :math:`f` çš„ :math:`n` é˜¶å¯¼æ•°ï¼Œ
æ³°å‹’å±•å¼€è¡¨è¾¾çš„å°±æ˜¯ :math:`f(x)` å¯ä»¥ç”¨å…¶é™„è¿‘çš„ç‚¹ :math:`f(x_0)` è¿‘ä¼¼çš„è¡¨ç¤ºã€‚

.. hint::

    æ³¨æ„ï¼Œæœ¬ä¹¦è®¨è®ºçš„è¿­ä»£æ±‚è§£ç®—æ³•é»˜è®¤ç›®æ ‡å‡½æ•°éƒ½æ˜¯å‡¸å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°æœ‰å”¯ä¸€çš„æå€¼ç‚¹ã€‚
    å…³äºéå‡¸å‡½æ•°ä»¥åŠå¸¦çº¦æŸçš„ä¼˜åŒ–é—®é¢˜ï¼Œè¯·è¯»è€…å‚è€ƒå…¶å®ƒèµ„æ–™ã€‚




æ¢¯åº¦ä¸‹é™æ³•
#######################################


æˆ‘ä»¬æŠŠå¯¹æ•°ä¼¼ç„¶å‡½æ•°æŒ‰ç…§æ³°å‹’å…¬å¼è¿›è¡Œå±•å¼€ï¼Œä½†æ˜¯æˆ‘ä»¬åªå±•å¼€åˆ°ä¸€é˜¶å¯¼æ•°ï¼ŒæŠŠæ›´é«˜é˜¶å¯¼æ•°çš„å’Œçœ‹åšä¸€ä¸ªå¸¸æ•°é‡constantï¼Œ


.. math::

    f(x)_{Taylor} = f(x_0) + f'(x_0)(x-x_0) +constant


ç°åœ¨æˆ‘ä»¬æŠŠå¯¹æ•°ä¼¼ç„¶å‡½æ•°æŒ‰ç…§ä¸Šå¼è¿›è¡Œå±•å¼€ï¼š

.. math::
    :label: eq_34_30

    \ell(\beta^{(t+1)}) = \ell(\beta^t) + \ell'(\beta^t)(\beta^{(t+1)} - \beta^t) + constant

å‡è®¾ :math:`\beta^{(t+1)}` æ˜¯å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„æå€¼ç‚¹ï¼Œä¹Ÿå°±æ˜¯å‚æ•°çš„æœ€ä¼˜è§£ï¼Œ
:math:`\beta^t` æ˜¯å…¶é™„è¿‘çš„ä¸€ä¸ªç‚¹ã€‚
ç°åœ¨æŠŠè¿™ä¸ªå¼å­è¿›è¡Œç®€å•çš„ç§»é¡¹å’Œå˜æ¢ï¼Œ


.. math::

    \ell(\beta^{(t+1)}) -  \ell(\beta^t) =\ell'(\beta^t)(\beta^{(t+1)} - \beta^t) +constant

æ˜¾ç„¶ :math:`\ell(\beta^{(t+1)})` åº”è¯¥æ˜¯å¤§äºç­‰äº :math:`\ell(\beta^t)` çš„ï¼Œ
å› æ­¤æœ‰

.. math::

    \ell(\beta^{(t+1)}) -  \ell(\beta^t) =\ell'(\beta^t)(\beta^{(t+1)} - \beta^t) +constant \ge 0


å¯¹ä¸Šè¿°å…¬å¼è¿›è¡Œç§»é¡¹å¤„ç†ï¼Œå¯å¾—ï¼š

.. math::
    :label: eq_34_31

    \beta^{(t+1)} \ge \beta^t - \frac{constant}{\ell'(\beta^t)}

æˆ‘ä»¬ç»™å‚æ•° :math:`\beta` è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼Œç„¶åé€šè¿‡ä¸Šå¼ä¸åœçš„è¿­ä»£è®¡ç®—æ–°çš„ :math:`\beta`
ï¼Œ:math:`t` è¡¨ç¤ºè¿­ä»£è®¡ç®—çš„è½®æ¬¡ï¼Œç›´åˆ°ç­‰å·æˆç«‹çš„æ—¶å€™ï¼Œå°±æ‰¾åˆ°äº†å‚æ•°çš„æœ€ä¼˜è§£ã€‚


é€šå¸¸æˆ‘ä»¬æŠŠä¸€é˜¶å¯¼ :math:`\ell'(\beta^t)` ç§°ä¸ºæ¢¯åº¦(gradient)ï¼Œ
:eq:`eq_34_31` è¯´æ˜åªè¦ :math:`\beta^{(t+1)}` æ²¿ç€ :math:`\beta^t` çš„è´Ÿæ¢¯åº¦æ–¹å‘è¿›è¡Œç§»åŠ¨ï¼Œæˆ‘ä»¬ç»ˆå°†èƒ½è¾¾åˆ°æå€¼ç‚¹ã€‚
æ³¨æ„ :math:`\frac{constant}{\ell'(\beta^t)}` **çš„ç»å¯¹å€¼çš„å¤§å°å½±å“ç€å‰è¿›çš„é€Ÿåº¦ï¼Œ**
**å…¶æ–¹å‘(æ­£è´Ÿå·)å†³å®šç›®æ ‡å‡½æ•°æ˜¯å¦å‘ç€æå¤§å€¼ç‚¹ç§»åŠ¨ã€‚**
æ‰€ä»¥å’Œä¸‹é¢çš„å…¬å¼æ˜¯ç­‰ä»·çš„ï¼Œ:math:`\alpha` ç§°ä¸ºå­¦ä¹ ç‡(learning rate)ï¼Œæ˜¯ä¸€ä¸ªäººå·¥è®¾ç½®å‚æ•°ï¼Œæ§åˆ¶çš„è¿­ä»£çš„é€Ÿåº¦ã€‚


.. math::
    :label: eq_34_32

    \beta^{(t+1)} = \beta^t - \alpha \ell'(\beta^t)


åˆ©ç”¨ :eq:`eq_34_32` è¿›è¡Œå‚æ•°è¿­ä»£æ±‚è§£çš„æ–¹æ³•å°±ç§°ä¸ºæ¢¯åº¦ä¸Šå‡æ³•ï¼Œ
æ¢¯åº¦ä¸Šå‡æ³•çš„æ ¸å¿ƒå°±æ˜¯è®©å‚æ•°å˜é‡æ²¿ç€è´Ÿæ¢¯åº¦çš„æ–¹å‘å‰è¿›ã€‚
è™½ç„¶ç†è®ºä¸Šæœ€ç»ˆä¸€å®šèƒ½åˆ°è¾¾æå€¼ç‚¹ï¼Œä½†æ˜¯å®é™…ä¸Šä¼šå—åˆ°å­¦ä¹ ç‡å‚æ•° :math:`\alpha` çš„å½±å“ï¼Œ
å­¦ä¹ ç‡å¯ä»¥ç†è§£æˆæ¯æ¬¡è¿­ä»£å‰è¿›çš„æ­¥é•¿(step size)ï¼Œæ­¥é•¿è¶Šå¤§å‰è¿›çš„è¶Šå¿«ï¼Œæ”¶æ•›æ€§é€Ÿåº¦å°±è¶Šå¿«ï¼›åä¹‹ï¼Œæ­¥é•¿è¶Šå°ï¼Œæ”¶æ•›è¶Šæ…¢ã€‚
ä½†æ˜¯æ­¥é•¿å¦‚æœå¤§äº†ï¼Œå°±ä¼šé€ æˆéœ‡è¡ç°è±¡ï¼Œå³ä¸€æ­¥è¿­ä»£å°±è¶Šè¿‡äº†ç»ˆç‚¹(æå€¼ç‚¹)ï¼Œå¹¶ä¸”åœ¨æå€¼ç‚¹é™„è¿‘å¾€è¿”éœ‡è¡ï¼Œæ°¸è¿œæ— æ³•æ”¶æ•›ã€‚
ä¸ºäº†ä¿è¯ç®—æ³•èƒ½ä¸€å®šæ”¶æ•›ï¼Œé€šå¸¸ä¼šä¸º :math:`\alpha` è®¾å®šä¸€ä¸ªè¾ƒå°çš„å€¼ã€‚
å…³äº :math:`\alpha` çš„æ›´å¤šè®¨è®ºè¯·å‚è€ƒå…¶å®ƒèµ„æ–™ã€‚

.. todo:: å›¾åäº†ï¼Œé‡æ–°æ¢ä¸ªå›¾ã€‚

.. _fg_34_3:

.. figure:: pictures/34_3.png
    :scale: 70 %
    :align: center

    æ¢¯åº¦ä¸‹é™æ³•ä¸­å­¦ä¹ ç‡çš„å½±å“(å›¾ç‰‡æ¥è‡ªç½‘ç»œ)





ç‰›é¡¿æ³•
############################################

æ¢¯åº¦ä¸‹é™æ³•è™½ç„¶ä¹Ÿèƒ½æ”¶æ•›åˆ°æœ€ä¼˜è§£ï¼Œä½†æ˜¯å¦‚æœå­¦ä¹ ç‡è®¾ç½®(é€šå¸¸äººå·¥è®¾ç½®)ä¸åˆç†ï¼Œå¯èƒ½ä¼šé€ æˆæ”¶æ•›é€Ÿåº¦å¤ªæ…¢æˆ–è€…æ— æ³•æ”¶æ•›çš„é—®é¢˜ï¼Œ
å…¶æ”¶æ•›é€Ÿåº¦éš¾ä»¥æœ‰æ•ˆçš„æ§åˆ¶ã€‚
ç°åœ¨æˆ‘ä»¬è®¨è®ºå¦ä¸€ä¸­è¿­ä»£ç®—æ³•ï¼Œç‰›é¡¿â€“æ‹‰å¤«æ£®æ–¹æ³•(Newtonâ€“Raphson)ï¼Œä¸€èˆ¬ç®€ç§°ç‰›é¡¿æ³•ã€‚
è¿˜æ˜¯ä»æ³°å‹’å±•å¼€å…¬å¼å¼€å§‹ï¼Œè®©æˆ‘ä»¬è€ƒè™‘äºŒé˜¶æ³°å‹’å±•å¼€ï¼š

.. math::
    :label: eq_34_33

    \ell(\beta^{(t+1)}) = \ell(\beta^t) + \ell'(\beta^t)(\beta^{(t+1)} - \beta^t) +
    \frac{1}{2}\ell''(\beta^t)(\beta^{(t+1)} - \beta^t)^2 + constant



æˆ‘ä»¬çŸ¥é“ç›®æ ‡å‡½æ•°åœ¨æå€¼ç‚¹å¤„çš„å¯¼æ•°åº”è¯¥ä¸º0ï¼Œ
æ‰€ä»¥å¦‚æœ :math:`\beta^{(t+1)}` æ˜¯æå€¼ç‚¹ï¼Œé‚£ä¹ˆæœ‰ :math:`\ell'(\beta^{(t+1)})=0`
ã€‚æˆ‘ä»¬å¯¹ :eq:`eq_34_33` è¿›è¡Œæ±‚å¯¼ï¼Œæ³¨æ„ :math:`\beta^{(t+1)}` æ‰æ˜¯å‡½æ•°æœªçŸ¥é‡ï¼Œ
:math:`\beta_t` å’Œ :math:`\ell(\beta^t)` éƒ½æ˜¯å·²çŸ¥é‡ã€‚

.. math::

    \ell'(\beta^{(t+1)})= \ell'(\beta^t) + \ell''(\beta^t)(\beta^{(t+1)}-\beta^t)=0


é€šè¿‡ç§»é¡¹å¯å¾—ï¼š

.. math::
    :label: eq_34_34

    \beta^{(t+1)} = \beta^t - \frac{\ell'(\beta^t)}{\ell''(\beta^t)}

è¿™ä¸ªè¿­ä»£ç­‰å¼ä¸­ï¼Œéœ€è¦åŒæ—¶ä½¿ç”¨åˆ°å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„ä¸€é˜¶å¯¼å’ŒäºŒé˜¶å¯¼æ•°ï¼Œ
äºŒé˜¶åå¯¼æ•°å¯ä»¥åœ¨ä¸€é˜¶å¯¼æ•°çš„åŸºç¡€ä¸Šå†æ¬¡æ±‚å¯¼å¾—åˆ°ï¼Œä¸Šä¸€èŠ‚å·²ç»è®²è¿‡ï¼Œ
å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„ä¸€é˜¶å¯¼æ•°åˆç§°ä¸ºå¾—åˆ†ç»Ÿè®¡é‡ã€‚

.. math::

   U_j = \frac{\partial \ell}{\partial \beta_j}
  = \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{ij}

æˆ‘ä»¬å¯¹ :math:`U_j` ç»§ç»­æ±‚å¯¼å°±æ˜¯å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„äºŒé˜¶å¯¼æ•°ã€‚

.. math::
    :label: eq_34_36

    \left (\frac{\partial^2 \ell }{\partial \beta_j \partial \beta_k} \right )
    &= \frac{\partial U_j}{\partial \beta_k}

    &=
    \sum_{i=1}^N \frac{1}{a(\phi)} \left (  \frac{\partial}{\partial \beta_k}   \right )
    \left \{ \frac{y_i-\mu_i}{\nu(\mu_i)} \left ( \frac{\partial \mu}{\partial \eta} \right)_i x_{jn} \right \}


    &= \sum_{i=1}^N \frac{1}{a(\phi)} \left [
        \left ( \frac{\partial \mu }{\partial \eta} \right )_i
        \left \{
            \left (  \frac{\partial  }{\partial \mu} \right )_i
            \left ( \frac{\partial \mu }{\partial \eta} \right )_i
            \left (  \frac{\partial \eta }{\partial \beta_k} \right )_i
        \right \} \frac{y_i-\mu_i}{\nu(\mu_i)}
        + \frac{y_i-\mu_i}{\nu(\mu_i)}
            \left \{
                    \left ( \frac{\partial  }{\partial \eta} \right )_i
                    \left ( \frac{\partial \eta }{\partial \beta_k} \right )_i
            \right \}
        \left ( \frac{\partial \mu }{\partial \eta} \right )_i
    \right ] x_{jn}


    &= -\sum_{i=1}^N \frac{1}{a(\phi)}
    \left [
        \frac{1}{\nu(\mu_i)}  \left ( \frac{\partial \mu}{\partial \eta} \right )_i^2
        -(\mu_i-y_i)
            \left \{
                \frac{1}{\nu(\mu_i)^2}  \left ( \frac{\partial \mu }{\partial \eta} \right )_i^2 \frac{\partial \nu(\mu_i)}{\partial \mu}
                - \frac{1}{\nu(\mu_i)}  \left ( \frac{\partial^2 \mu}{\partial \eta^2} \right )_i
            \right \}
    \right ] x_{jn}x_{kn}


å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„äºŒé˜¶åå¯¼æ•°æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œè¿™ä¸ªçŸ©é˜µåˆå«æµ·æ£®çŸ©é˜µ ``Hessian matrix`` ï¼Œ
å¸¸ç”¨ç¬¦å· :math:`H` è¡¨ç¤ºã€‚ç‰›é¡¿æ³•çš„è¿­ä»£å…¬å¼å¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼Œ

.. math::
    :label: eq_34_35

     \beta^{(t+1)} = \beta^{(t)} - H(\beta^{(t)})^{-1} U(\beta^{(t)})


å’Œæ¢¯åº¦ä¸‹é™æ³•çš„ :eq:`eq_34_32` å¯¹æ¯”ä¸‹å‘ç°ï¼Œä¸¤è€…éå¸¸ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯ç‰›é¡¿æ³•ç”¨HessiançŸ©é˜µçš„é€†çŸ©é˜µ :math:`H(\beta^{(t)})^{-1}`
æ›¿ä»£äº†å­¦ä¹ ç‡å‚æ•°ï¼Œé¿å…äº†éœ€è¦äººå·¥è®¾ç½®å­¦ä¹ ç‡çš„é—®é¢˜ã€‚ç›¸æ¯”æ¢¯åº¦ä¸‹é™æ³•ï¼Œç‰›é¡¿æ³•æ”¶æ•›é€Ÿåº¦æ›´å¿«ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰éœ‡è¡æ— æ³•æ”¶æ•›çš„é—®é¢˜ã€‚

è§‚å¯Ÿä¸‹ :eq:`eq_34_36` ï¼Œ
GLMçš„æµ·æ£®çŸ©é˜µè®¡ç®—éš¾åº¦æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ
æœ‰æ—¶å€™ä¼šç”¨æµ·æ£®çš„çŸ©é˜µçš„æœŸæœ› :math:`\mathbb{E}[H]` æ›¿ä»£ã€‚
ä» :eq:`eq_34_36` å¯ä»¥çœ‹åˆ°ï¼Œæµ·æ£®çŸ©é˜µæ˜¯ä¸€ä¸ªå…³äºå“åº”å˜é‡ :math:`Y`
çš„å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥å¯¹æµ·æ£®çŸ©é˜µæ±‚å…³äº :math:`Y` çš„æœŸæœ›ã€‚


.. math::
    :label: eq_glm_estimate_030

    \mathbb{E}_{y}[H]_{jk} &= \mathbb{E}_{y} \left [
    -\sum_{i=1}^N \frac{1}{a(\phi)}
    \left [
        \frac{1}{\nu(\mu_i)}  \left ( \frac{\partial \mu}{\partial \eta} \right )_i^2
        -(\mu_i-y_i)
            \left \{
                \frac{1}{\nu(\mu_i)^2}  \left ( \frac{\partial \mu }{\partial \eta} \right )_i^2 \frac{\partial \nu(\mu_i)}{\partial \mu}
                - \frac{1}{\nu(\mu_i)}  \left ( \frac{\partial^2 \mu}{\partial \eta^2} \right )_i
            \right \}
    \right ] x_{ij}x_{ik}
    \right ]

    &=
    -\sum_{i=1}^N \frac{1}{a(\phi)}
    \left [
        \frac{1}{\nu(\mu_i)}  \left ( \frac{\partial \mu}{\partial \eta} \right )_i^2
        -(\mu_i- \mathbb{E} [y_i])
            \left \{
                \frac{1}{\nu(\mu_i)^2}  \left ( \frac{\partial \mu }{\partial \eta} \right )_i^2 \frac{\partial \nu(\mu_i)}{\partial \mu}
                - \frac{1}{\nu(\mu_i)}  \left ( \frac{\partial^2 \mu}{\partial \eta^2} \right )_i
            \right \}
    \right ] x_{ij}x_{ik}

    &= -\sum_{i=1}^N \frac{ x_{ij}x_{ik}}{a(\phi)\nu(\mu_i)}
        \left ( \frac{\partial \mu}{\partial \eta} \right )_i^2


åœ¨å‚æ•°çš„è¿­ä»£è¿‡ç¨‹ä¸­ä½¿ç”¨ :math:`\mathbb{E}[H]` å’Œä½¿ç”¨ :math:`H`
åœ¨å‚æ•°æ”¶æ•›æ•ˆæœä¸Šæ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼ŒäºŒè€…æ˜¯ç±»ä¼¼çš„ï¼Œä½†æ˜¯ :math:`\mathbb{E}[H]` çš„è®¡ç®—è¦ç®€åŒ–äº†å¾ˆå¤šã€‚
åŸå§‹æµ·æ£®çŸ©é˜µ :math:`H` çš„è®¡ç®—ä¾èµ–è§‚æµ‹æ ·æœ¬ :math:`y_i` ï¼Œ
æ‰€ä»¥é€šå¸¸ä¼šæŠŠåŸå§‹æµ·æ£®çŸ©é˜µç§°ä¸ºè§‚æµ‹æµ·æ£®çŸ©é˜µ(observed Hessian)
ï¼Œä»–çš„æœŸæœ›çŸ©é˜µç§°ä¸ºæœŸæœ›æµ·æ£®(expected Hessian) ã€‚

.. math::
    :label: eq_glm_estimate_031

     \beta^{(t+1)} = \beta^{(t)} - \mathbb{E}[H(\beta^{(t)})]^{-1} U(\beta^t)


å¯¹æ¯”ä¸‹ä¿¡æ¯çŸ©é˜µ :eq:`eq_glm_estimate_019` å’ŒæœŸæœ›æµ·æ£® :eq:`eq_glm_estimate_030`
ï¼ŒäºŒè€…åªå·®ä¸€ä¸ªè´Ÿå·ï¼Œæ˜¯ç›¸åæ•°çš„å…³ç³»ï¼Œè¿™å’Œæˆ‘ä»¬åœ¨
:numref:`ch_2_Fisher_Information` è®¨è®ºçš„ç»“è®ºæ˜¯ä¸€è‡´çš„ï¼Œ

.. math::

    \mathcal{J} = - \mathbb{E}[H]

å› æ­¤ç‰›é¡¿æ³•çš„è¿­ä»£è¿‡ç¨‹ :eq:`eq_glm_estimate_031`
ç»å¸¸ä¹Ÿä¼šå†™æˆ

.. math::

         \beta^{(t+1)} = \beta^{(t)} + \mathcal{J}(\beta^{(t)})^{-1} U(\beta^t)

åœ¨ :numref:`ch_2_Fisher_Information` è®¨è®ºè¿‡ï¼Œå‚æ•°çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡ä¼°è®¡é‡æ˜¯ä¸€ä¸ªç»Ÿè®¡é‡ï¼Œ
å¹¶ä¸”å…¶æ¸è¿›æœä»æ­£æ€åˆ†å¸ƒï¼Œå…¶æ–¹å·®å¯ä»¥é€šè¿‡ä¿¡æ¯çŸ©é˜µ :math:`\mathcal{J}` è®¡ç®—å¾—åˆ°ã€‚
æœ€ç»ˆï¼ŒNewtonâ€“Raphson æä¾›äº†å¦‚ä¸‹åŠŸèƒ½ï¼š

1. ä¸ºæ‰€æœ‰å•å‚æ•°çš„GLMæˆå‘˜æ¨¡å‹æä¾›ä¸€ä¸ªå‚æ•°ä¼°è®¡ç®—æ³•ã€‚
2. å‚æ•°ä¼°è®¡å€¼çš„æ ‡å‡†è¯¯(standard errors)çš„è®¡ç®—ï¼šè´Ÿçš„ Hessian matrix é€†çŸ©é˜µçš„å¯¹è§’çº¿å…ƒç´ çš„å¹³æ–¹æ ¹ã€‚

æˆ‘ä»¬è¿™é‡Œæè¿°çš„ Newtonâ€“Raphson ç®—æ³•ä¸æ”¯æŒåˆ†æ•£å‚æ•°(dispersion parameter)ï¼Œ :math:`\phi`
ï¼Œçš„ä¼°è®¡ï¼Œä¸€äº› Newtonâ€“Raphson çš„æ‰©å±•ç®—æ³•å¯ä»¥æä¾›åˆ†æ•£å‚æ•°çš„MLä¼°è®¡ã€‚




**è¿­ä»£åˆå§‹å€¼çš„è®¾å®š**

è¦å®ç° Newtonâ€“Raphson è¿­ä»£æ³•ï¼Œ
æˆ‘ä»¬å¿…é¡»å¯¹å‚æ•°åˆå§‹å€¼æœ‰ä¸€ä¸ªçŒœæµ‹ã€‚
ä½†ç›®å‰æ²¡æœ‰ç”¨äºè·å¾—è‰¯å¥½å‚æ•°åˆå€¼çš„å…¨å±€æœºåˆ¶ï¼Œ
ä½†æ˜¯æœ‰ä¸€ä¸ªåˆç†çš„è§£å†³æ–¹æ¡ˆå¯ä»¥åœ¨æ¨¡å‹ä¸­å­˜åœ¨"å¸¸æ•°é¡¹ç³»æ•°"æ—¶è·å¾—èµ·å§‹å€¼ã€‚

è¿™é‡Œçš„"å¸¸æ•°é¡¹"æŒ‡çš„æ˜¯çº¿æ€§é¢„æµ‹å™¨ä¸­æˆªè·éƒ¨åˆ†


.. math::

    \eta = \beta_0 \times 1 + \beta_1 x_1 +\dots + \beta_px_p

å…¶ä¸­ :math:`\beta_0` å°±æ˜¯å¸¸æ•°é¡¹ç³»æ•°ã€‚
å¦‚æœæ¨¡å‹åŒ…å«å¸¸æ•°é¡¹ï¼Œåˆ™é€šå¸¸çš„åšæ³•æ˜¯æ‰¾åˆ°ä»…åŒ…å«å¸¸æ•°é¡¹ç³»æ•°çš„æ¨¡å‹çš„ä¼°è®¡å€¼ã€‚
æˆ‘ä»¬ä»¤ï¼š

.. math::

    \eta = \beta_0

ç„¶åä»¤å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„ä¸€é˜¶å¯¼æ•° :eq:`eq_34_jac` ä¸º0ï¼Œæ‰¾åˆ° :math:`\beta_0`
çš„è§£æè§£ã€‚

.. math::
    :label: eq_34_37

    \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i
    =0

é€šè¿‡ä¸Šå¼æ˜¯å¯ä»¥å¾—åˆ° :math:`\beta_0` çš„ä¸€ä¸ªä¼°è®¡å€¼çš„ã€‚
æ¯”å¦‚å¦‚æœæ˜¯é€»è¾‘å›å½’æ¨¡å‹ï¼Œåˆ™æœ‰ï¼š

.. math::

    a(\phi) &= 1

    \nu(\mu) &= \mu(1-\mu)

    \mu &= \text{sigmoid}(\eta_i) = \text{sigmoid}(\beta_0)

    \frac{\partial \mu}{\partial \eta} &= \frac{\partial }{\partial \eta} \text{sigmoid} (\eta) = \mu(1-\mu)

ä»£å…¥åˆ° :eq:`eq_34_37` å¯å¾—ï¼š


.. math::

    \sum_{i=1}^N \frac{(y_i- \mu_i ) }{\mu_i(1-\mu_i)} \mu_i(1-\mu_i) &= 0

     &\Downarrow

    \sum_{i=1}^N (y_i- \mu_i) &=0

     &\Downarrow

    \sum_{i=1}^N (y_i- \frac{1}{1+e^{-\beta_0}}) &=0

     &\Downarrow

     \underbrace{\frac{1}{N}\sum_{i=1}^N y_i}_{\text{å‡å€¼}\bar{y}} &=  \frac{1}{1+e^{-\beta_0}}


    &\Downarrow{\text{sigmoidåå‡½æ•°æ±‚è§£}}

    \hat{\beta}_0 &= \ln \left (  \frac{\bar{y}}{1-\bar{y}}   \right )

ç„¶åæˆ‘ä»¬å°±ç”¨ :math:`\beta=(\hat{\beta}_0,0,0,\dots,0)^T` ä½œä¸º Newtonâ€“Raphson ç®—æ³•é¦–æ¬¡è¿­ä»£æ—¶å‚æ•°å‘é‡çš„åˆå§‹å€¼ã€‚
ä½¿ç”¨è¿™ç§æ–¹æ³•ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªä¼˜ç‚¹ã€‚
é¦–å…ˆï¼Œæˆ‘ä»¬ä»å‚æ•°ç©ºé—´çš„åˆç†å­é›†å¼€å§‹è¿­ä»£ã€‚
å…¶æ¬¡ï¼Œå¯¹äºMLï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ä»…å¸¸æ•°é¡¹ç³»æ•°æ¨¡å‹çš„è§£å†³æ–¹æ¡ˆï¼Œ
æ‰€ä»¥å¯ä»¥å°†è®­ç»ƒæ¨¡å‹çš„å¯¹æ•°ä¼¼ç„¶ä¸ç®—æ³•åˆå§‹æ­¥éª¤ä¸­è·å¾—çš„ä»…å¸¸æ•°é¡¹ç³»æ•°æ¨¡å‹çš„å¯¹æ•°ä¼¼ç„¶è¿›è¡Œæ¯”è¾ƒã€‚
æ­¤æ¯”è¾ƒæ˜¯æ¯ä¸ªåå˜é‡ï¼ˆå¸¸æ•°é¡¹ç³»æ•°é™¤å¤–ï¼‰å‡ä¸ºé›¶çš„ä¼¼ç„¶æ¯”æ£€éªŒï¼Œåœ¨åç»­ç« èŠ‚ä¼šä»‹ç»ä»€ä¹ˆæ˜¯ä¼¼ç„¶æ¯”æ£€éªŒã€‚
å¦‚æœæ¨¡å‹ä¸­æ²¡æœ‰å¸¸é‡é¡¹ç³»æ•°ï¼Œæˆ–è€…å¦‚æœæˆ‘ä»¬æ— æ³•è§£ææ³•æ±‚è§£çº¯å¸¸æ•°é¡¹ç³»æ•°æ¨¡å‹ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æ›´å¤æ‚çš„æ–¹æ³•ï¼Œ
æ¯”å¦‚ä½¿ç”¨æœç´¢æ–¹æ³•å¯»æ‰¾åˆç†çš„åˆå§‹ç‚¹æ¥å¼€å§‹æˆ‘ä»¬çš„ Newton-Raphson ç®—æ³•ã€‚




è¿­ä»£é‡åŠ æƒæœ€å°äºŒä¹˜(IRLS)
#####################################################

ä½¿ç”¨ç‰›é¡¿æ³•å¯¹GLMä¸­çš„æ¨¡å‹è¿›è¡Œå‚æ•°ä¼°è®¡æ—¶ï¼Œ
éœ€è¦æŠŠæ¯ä¸ªæ¨¡å‹çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°é€šè¿‡ :math:`\beta` è¿›è¡Œå‚æ•°åŒ–ï¼Œ
ç„¶åæ±‚å‡ºå¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„åå¯¼æ•°ï¼Œå¹¶ä¸”åœ¨è¿­ä»£å¼€å§‹å‰éœ€è¦ç»™
:math:`\beta` ä¸€ä¸ªåˆå§‹å€¼ï¼Œè¿™ç§æ–¹æ³•è¿‡äºç¹çï¼Œ
æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»ç‰›é¡¿æ³•åœ¨GLMä¸­çš„ä¸€ä¸ªå˜ç§ç®—æ³•ï¼Œ
è¿­ä»£é‡åŠ æƒæœ€å°äºŒä¹˜(iterative weighted least squares,IRLS)ç®—æ³•ï¼Œ
IRLSç®—æ³•æ˜¯GLMçš„ä¸€ä¸ªé€šç”¨å‹å‚æ•°ä¼°è®¡ç®—æ³•ï¼Œå¯ç”¨äºä»»æ„çš„æŒ‡æ•°æ—åˆ†å¸ƒå’Œè¿æ¥å‡½æ•°ï¼Œ
å¹¶ä¸”ä¸éœ€è¦å¯¹ :math:`\beta` è¿›è¡Œåˆå§‹åŒ–ã€‚


ç®—æ³•æ¨å¯¼
============================================

é‡‡ç”¨æœŸæœ›æµ·æ£®çŸ©é˜µçš„ç‰›é¡¿æ³•çš„å‚æ•°è¿­ä»£ç­‰å¼ä¸º

.. math::
    \beta^{(t+1)} = \beta^{(t)} + [\mathcal{J}^{(t)}]^{-1} U^{(t)}



ç­‰å¼ä¸¤è¾¹åŒæ—¶ä¹˜ä»¥ä¿¡æ¯çŸ©é˜µ :math:`\mathcal{J}` ï¼Œ

.. math::

    \mathcal{J}^{(t)}\beta^{(t+1)} = \mathcal{J}^{(t)} \beta^{(t)} +  U^{(t)}

å‡è®¾åå˜é‡å‚æ•° :math:`\beta` çš„æ•°é‡æ˜¯ :math:`p`
ï¼Œåˆ™ä¿¡æ¯çŸ©é˜µ :math:`\mathcal{J}` æ˜¯ä¸€ä¸ª :math:`p\times p`
çš„æ–¹é˜µï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´  :math:`\mathcal{J}_{jk}` ä¸º

.. math::
    \mathcal{J}_{jk}=
    \sum_{i=1}^N
    \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{  x_{ij} x_{ik}}{ a(\phi) \nu(\mu_i) }



ä»”ç»†è§‚å¯Ÿ :math:`\mathcal{J}_{jk}` çš„è®¡ç®—å…¬å¼ï¼Œ
å‡è®¾æœ‰ä¸€ä¸ª :math:`N\times N` çš„å¯¹è§’çŸ©é˜µ
ï¼Œæ¯ä¸ªå¯¹è§’å…ƒç´ ä¸º

.. math::

    W_{ii} = \text{diag} \left \{ \frac{ 1}{ a(\phi) \nu(\mu_i) }
    \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i
    \right \}_{(N\times N)}


æ–¹é˜µ :math:`\mathcal{J}` å°±ç›¸å½“äºä¸‰ä¸ªçŸ©é˜µçš„ä¹˜æ³•

.. math::
    :label: eq_glm_estimate_041

    \mathcal{J} = X^T W X





è¿™ä¸ªç­‰å¼æˆ‘ä»¬å…ˆè®°å½•ä¸‹ï¼Œä¹‹åå†ä½¿ç”¨ã€‚
ç°åœ¨çœ‹ä¸‹ :math:`\mathcal{J} \beta` çš„ç»“æœæ˜¯ä»€ä¹ˆã€‚
å‚æ•° :math:`\beta` æ˜¯ä¸€ä¸ª :math:`p \times 1`
çš„åˆ—å‘é‡ï¼Œä¸‹æ ‡ :math:`j` è¡¨ç¤ºè¡Œåæ ‡ï¼Œä¸‹æ ‡ :math:`k` è¡¨ç¤ºåˆ—åæ ‡ã€‚
æ–¹é˜µ :math:`\mathcal{J}` å’Œåˆ—å‘é‡ :math:`\beta`
ç›¸ä¹˜çš„è®¡ç®—è¿‡ç¨‹æ˜¯æ–¹é˜µ :math:`\mathcal{J}` çš„æ¯ä¸€è¡Œå‘é‡å’Œåˆ—å‘é‡ :math:`\beta`
è¿›è¡Œå…§ç§¯è¿ç®—ï¼Œå› æ­¤è¡Œå‘é‡ :math:`\mathcal{J}_j` å’Œ
åˆ—å‘é‡ :math:`\beta` çš„å…§ç§¯ç»“æœä¸º

.. math::

    \mathcal{J}_{j} \beta
    &=
    \sum_{i=1}^N
    \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{  x_{ij} x_{i}\beta}{ a(\phi) \nu(\mu_i) }

    &=    \sum_{i=1}^N
    \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{  x_{ij} \eta_i}{ a(\phi) \nu(\mu_i) }




ç°åœ¨æˆ‘ä»¬æŠŠ :eq:`eq_34_35` ç¨å¾®å˜æ¢ä¸€ä¸‹ï¼Œå¹¶ä¸”æˆ‘ä»¬ç”¨ :math:`I(\beta^{(t)})` æ›¿æ¢
:math:`- H(\beta^{(t)})` ã€‚

.. math::
    :label: eq_34_45

       \Delta \beta^{(t)} = \beta^{(t+1)} - \beta^{(t)} &=  - H(\beta^{(t)})^{-1} \ell'(\beta^{(t)})

     & \Downarrow{\text{ç§»é¡¹}}

      - H(\beta^{(t)})  \Delta \beta^{(t)} &= \ell'(\beta^{(t)})

     & \Downarrow{\text{Hessiançš„æœŸæœ›}}

    - \mathbb{E}[H(\beta^{(t)})] \Delta \beta^{(t)} &= \ell'(\beta^{(t)})

    & \Downarrow{\text{ä¿¡æ¯çŸ©é˜µ}}

    I(\beta^{(t)})\Delta \beta^{(t)} &= \ell'(\beta^{(t)})


ç°åœ¨æˆ‘ä»¬æŠŠ :eq:`eq_34_jac` å’Œ :eq:`eq_34_44` ä»£å…¥ä¸Šå¼ï¼Œå¾—åˆ°ä¸€ä¸ªç­‰å¼ï¼š

.. math::
    :label: eq_34_46

    \left \{
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{ 1}{ a(\phi) \nu(\mu_i) }   x_{jn} x_{kn}
    \right \}
    \Delta \beta^{(t)} =
     \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{n}^T
    \ \ \ \ \text{(ç­‰å¼A)}


:eq:`eq_34_46` å…ˆä¿ç•™ï¼Œæˆ‘ä»¬è®°ä¸ºç­‰å¼Aï¼Œæˆ‘è¿˜éœ€è¦å€ŸåŠ©å¦å¤–ä¸€ä¸ªç­‰å¼ã€‚
æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºæ¯æ¡æ ·æœ¬çº¿æ€§é¢„æµ‹å™¨çš„æ–¹ç¨‹ä¸ºï¼š

.. math::

    \eta_i^{(t)} =  x_i^T \beta^{(t)}


æˆ‘ä»¬æŠŠ :eq:`eq_34_46` ä¸­çš„ :math:`\Delta \beta^{(t)}`
æ¢æˆ :math:`\beta^{(t)}`
ï¼Œå¹¶ç»“åˆçº¿æ€§é¢„æµ‹å™¨ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç­‰å¼ã€‚

.. math::
    :label: eq_34_47

    & \left \{
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{ 1}{ a(\phi) \nu(\mu_i) }   x_{jn} x_{kn}
    \right \} \beta^{(t)}

    &= \left \{
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{ 1}{ a(\phi) \nu(\mu_i) }  x_i  x_i^T
    \right \} \beta^{(t)}

    &=
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{ 1}{ a(\phi) \nu(\mu_i) } \beta^{(t)T}  x_i  x_i^T


    &=
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{ 1}{ a(\phi) \nu(\mu_i) } \eta_i^{(t)}  x_i^T



å»æ‰ :eq:`eq_34_47` çš„ä¸­é—´æ¨å¯¼è¿‡ç¨‹ï¼Œç›´æ¥å¾—åˆ°å¦‚ä¸‹ç­‰å¼ï¼Œæˆ‘ä»¬è®°ä¸ºç­‰å¼Bã€‚

.. math::
    :label: eq_34_48

    \left \{
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{ 1}{ a(\phi) \nu(\mu_i) }   x_{jn} x_{kn}
    \right \} \beta^{(t)}
    =
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{ 1}{ a(\phi) \nu(\mu_i) } \eta_i^{(t)}  x_i^T
    \ \ \ \ \text{(ç­‰å¼B)}

ç°åœ¨æˆ‘ä»¬æŠŠç­‰å¼A( :eq:`eq_34_46` )å’Œç­‰å¼B( :eq:`eq_34_48` )çš„ç­‰å·ä¸¤è¾¹ç›¸åŠ ï¼š

.. math::
    :label: eq_34_49

    \left \{
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{ 1}{ a(\phi) \nu(\mu_i) }   x_{jn} x_{kn}
    \right \} (\beta^{(t)} + \Delta \beta^{(t)} ) &=
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i \frac{ 1}{ a(\phi) \nu(\mu_i) }
    \left \{
    (y_i-\mu_i)\left ( \frac{\partial \eta}{\partial \mu}_i \right) + \eta_i^{(t)}
    \right \} x_i^T


     & \Downarrow

    \underbrace{ \left \{
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i  \frac{ 1}{ a(\phi) \nu(\mu_i) }   x_{jn} x_{kn}
    \right \} }_{\text{çŸ©é˜µ}}
    \beta^{(t+1)}
    &=
    \sum_{i=1}^N \left ( \frac{\partial \mu}{\partial \eta} \right )^2_i \frac{ 1}{ a(\phi) \nu(\mu_i) }
    \left \{
    (y_i-\mu_i)\left ( \frac{\partial \eta}{\partial \mu} \right)_i+ \eta_i^{(t)}
    \right \} x_i^T


ä¸Šå¼çœ‹ä¸Šå»å¾ˆå¤æ‚ï¼Œä½†å…¶å®å¯ä»¥è½¬åŒ–æˆçŸ©é˜µçš„ä¹˜æ³•ï¼Œæˆ‘ä»¬å®šä¹‰å¦‚ä¸‹ä¸¤ä¸ªçŸ©é˜µï¼š

.. math::


    W^{(t)} &= \text{diag} \left \{ \frac{ 1}{ a(\phi) \nu(\mu) }
    \left ( \frac{\partial \mu}{\partial \eta} \right )^2
    \right \}_{(n\times n)}  \ \ \ \ \text{å¯¹è§’çŸ©é˜µ}


    Z^{(t)} &= \left \{ (y-\mu)  \left ( \frac{\partial \eta}{\partial \mu} \right) + \eta^{(t)}
    \right \}_{(n\times 1 )}


å…¶ä¸­ï¼Œ:math:`a(\phi)` æ˜¯åˆ†æ•£å‡½æ•°ï¼Œ:math:`\nu(\mu)` æ˜¯æ–¹å·®å‡½æ•°ï¼Œ
:math:`\frac{\partial \mu}{\partial \eta}` æ˜¯å“åº”å‡½æ•° :math:`r` çš„å¯¼æ•°ï¼Œ
ç­‰ä»·äºè¿æ¥å‡½æ•° :math:`g` çš„å¯¼æ•°çš„è´Ÿæ•°ã€‚
:math:`\frac{\partial \eta}{\partial \mu}` æ˜¯è¿æ¥å‡½æ•° :math:`g` å¯¹ :math:`\mu` çš„å¯¼æ•°ã€‚
:eq:`eq_34_49` å°±å¯ä»¥æ”¹å†™æˆçŸ©é˜µä¹˜ç§¯çš„å½¢å¼ï¼š

.. math::
    :label: eq_34_49_1

    (X^TW^{(t)} X) \beta^{(t+1)} &= X^T W^{(t)} Z^{(t)}

     & \Downarrow{\text{ç§»é¡¹}}


    \beta^{(t+1)} &= (X^TW^{(t)} X)^{-1} X^T W^{(t)} Z^{(t)}



:eq:`eq_34_49_1` å°±æ˜¯æœ€ç»ˆå‚æ•°å‘é‡æ›´æ–°çš„å…¬å¼ï¼Œå®ƒåœ¨å½¢å¼ä¸Šç­‰ä»·äºåŠ æƒçš„æœ€å°äºŒä¹˜æ³•ï¼Œ
å…¶ä¸­ :math:`W` æ˜¯æƒé‡çŸ©é˜µï¼Œå¹¶ä¸”æ¯ä¸€æ¬¡è¿­ä»£éƒ½è¦é‡æ–°è®¡ç®— :math:`W`
ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªç®—æ³•ç§°ä¸ºè¿­ä»£é‡åŠ æƒæœ€å°äºŒä¹˜æ³•(Iteratively Reweighted Least Square,IRLS)ï¼Œ
"reweighted" æŒ‡çš„å°±æ˜¯æ¯æ¬¡è¿­ä»£é‡æ–°è®¡ç®—æƒé‡çŸ©é˜µã€‚

ä½¿ç”¨å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„äºŒé˜¶åå¯¼æ•°çš„ Hessian çŸ©é˜µï¼Œæ˜¯ç”¨è§‚æµ‹æ ·æœ¬å€¼è®¡ç®—å¾—åˆ°çš„ï¼Œæ‰€ä»¥ç§°ä¸ºè§‚æµ‹æµ·æ£®çŸ©é˜µ(observed Hessian matrix)ï¼Œ
æœ‰æ—¶ä¹Ÿå«è§‚æµ‹ä¿¡æ¯çŸ©é˜µ(observed information Matrix,OIM)ï¼Œ
ç‰›é¡¿æ³•å°±æ˜¯é‡‡ç”¨çš„OIMã€‚

å¦ä¸€ç§æ–¹æ³•å°±æ˜¯ç”¨æµ·æ£®çŸ©é˜µçš„æœŸæœ›çŸ©é˜µ(expected Hessian matrix)ï¼Œ
æœŸæœ›æµ·æ£®çŸ©é˜µåˆè¢«ç§°ä¸ºè´¹æ­‡å°”ä¿¡æ¯çŸ©é˜µ(Fisher information matrix)ï¼Œ
æ‰€ä»¥è¿™ç§æ–¹æ³•ä¹Ÿç§°ä¸ºæœŸæœ›ä¿¡æ¯çŸ©é˜µ(expected information matrix,EIM)ï¼ŒIRLSç®—æ³•å°±æ˜¯ä½¿ç”¨EIMã€‚
IRLSå’Œç‰›é¡¿æ³•çš„åŒºåˆ«å°±æ˜¯ï¼Œç‰›é¡¿æ³•æ˜¯ç”¨çš„æ˜¯OIMï¼ŒIRLSç®—æ³•ä½¿ç”¨çš„æ˜¯EIMï¼Œ
ä¸€èˆ¬æƒ…å†µä¸‹ä¸¤ç§ç®—æ³•çš„ä¼°è®¡å€¼æ˜¯ä¸€è‡´çš„ã€‚



è¿­ä»£åˆå§‹å€¼çš„è®¾å®š
====================================================

å¯¹æ¯”ä¸‹ Newtonâ€“Raphson ç®—æ³•çš„å‚æ•°è¿­ä»£å…¬å¼( :eq:`eq_34_35` )
å’ŒIRLSç®—æ³•çš„å‚æ•°è¿­ä»£å…¬å¼( :eq:`eq_34_49_1` )ï¼Œ
å¯ä»¥å‘ç°IRLSç®—æ³•å¹¶ä¸éœ€è¦ç›´æ¥åœ¨ :math:`\beta^{(t)}` çš„åŸºç¡€ä¸Šè¿›è¡Œå‚æ•°è¿­ä»£ï¼Œ
**IRLSç®—æ³•çš„å‚æ•°è¿­ä»£ä»…ä»…ä¾èµ–** :math:`\mu` **å’Œ** :math:`\eta`
ï¼Œå› æ­¤ä¸ Newtonâ€“Raphson ç®—æ³•ä¸åŒçš„æ˜¯ï¼ŒIRLS ä¸éœ€è¦å¯¹å‚æ•°å‘é‡ :math:`\beta`
è¿›è¡Œåˆå§‹å€¼çš„çŒœæµ‹ï¼Œåªéœ€è¦ç»™ :math:`\mu` å’Œ :math:`\eta` èµ‹äºˆä¸€ä¸ªåˆå§‹å€¼å³å¯ã€‚

- å¯¹äºäºŒé¡¹å¼åˆ†å¸ƒï¼Œå¯ä»¥ä»¤ :math:`\mu_i^{(0)}=k_i(y_i+0.5)/(k_i+1)`
  ï¼Œ:math:`\eta_i^{(0)}=g(\mu_i^{(0)})` ã€‚

- å¯¹äºéäºŒé¡¹å¼åˆ†å¸ƒï¼Œå¯ä»¥ä»¤ :math:`\mu_i^{(0)}=y_i`
  ï¼Œ :math:`\eta_i^{(0)}=g(\mu_i^{(0)})` ã€‚


IRLSç®—æ³•åœ¨æ›´æ–°æ—¶ï¼Œåªä¾èµ–æœŸæœ› :math:`\mu` å’Œ çº¿æ€§é¢„æµ‹å™¨ :math:`\eta` ï¼Œ
é‰´äºè¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨æœŸæœ› :math:`\mu` å¯¹GLMæ¨¡å‹çš„æ¦‚ç‡å‡½æ•°è¿›è¡Œå‚æ•°åŒ–ï¼Œè€Œä¸éœ€è¦ç»†åŒ–åˆ° :math:`\beta`
ï¼Œè¿™å¯ä»¥æå¤§çš„é™ä½GLMæ¨¡å‹æ¦‚ç‡å‡½æ•°çš„å¤æ‚æ€§ã€‚

.. code-block:: python3
   :linenos:

   ğœ‡={ğ‘¦+ğ‘šğ‘’ğ‘ğ‘›(ğ‘¦)}/2  # åˆå§‹åŒ–å‚æ•° ğœ‡
   ğœ‚=ğ‘”(ğœ‡)  # åˆå§‹åŒ–å‚æ•° ğœ‚

   WHILE(abs(Î” Dev)>tolerance){
      W = 1/(ğ‘(ğœ™) ğœˆ g'^2)   #è®¡ç®—WçŸ©é˜µ  g'^2 æ˜¯è¿æ¥å‡½æ•°ä¸€é˜¶å¯¼æ•°çš„å¹³æ–¹
      Z = ğœ‚ +(y-ğœ‡)g'
      Î²=Inverse(X^T W X) X^T W Z  # æ›´æ–°æ–°çš„å‚æ•°å€¼
      Î·=XÎ²   # è®¡ç®—æ–°çš„çº¿æ€§é¢„æµ‹å™¨
      Î¼=r(Î·)  # è®¡ç®—æ–°çš„é¢„æµ‹ç»“æœ
      OldDev = Dev
      Dev = deviance function() # è®¡ç®—æ–°çš„åå·®å€¼
      Î”Dev = Dev - OldDev  # åå·®å€¼çš„å˜åŒ–é‡
   }
   Ï‡^2= âˆ‘ (yâˆ’Î¼)^2â„v







æ”¶æ•›æ€§åˆ¤æ–­
====================================================

åœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å‚æ•° :math:`\beta` çš„ç›¸å¯¹å˜åŒ–æ¥å†³å®šæ˜¯å¦ç»“æŸç®—æ³•ã€‚

.. math::

    \sqrt{\frac{ (\beta^{new}-\beta^{old})^T (\beta^{new}-\beta^{old})  }{ \beta^{old^T} \beta^{new} } } < \epsilon

ä¹Ÿå¯ä»¥é€šè¿‡ç›¸å¯¹åå·®æ¥åˆ¤æ–­ã€‚

.. math::

    \left|\frac{D(y-\mu^{new})-D(y,\mu^{old})   }{D(y,\mu^{old})} \right| <\epsilon



ä¼°è®¡é‡çš„æ ‡å‡†è¯¯å·®
====================================================

å›é¡¾ä¸€ä¸‹åœ¨ :numref:`ch_2_MLE_estimator` æˆ‘ä»¬è®²çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡é‡çš„è¯„ä»·ï¼Œ
æˆ‘ä»¬çŸ¥é“æœ€å¤§ä¼¼ç„¶ä¼°è®¡é‡çš„åæ–¹å·®çŸ©é˜µå°±æ˜¯ :math:`I(\beta)^{-1}`
ï¼Œæ˜¾ç„¶åœ¨IRLSç®—æ³•è¿‡ç¨‹ä¸­å·²ç»è®¡ç®—å‡ºäº† :math:`I(\beta)^{-1}=- \mathbb{E}[H(\beta)]=(X^TW^{(t)} X)^{-1}`
ï¼Œæ‰€ä»¥ä½¿ç”¨IRLSæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¾—åˆ°ä¼°è®¡é‡çš„æ ‡å‡†è¯¯å·®ã€‚

.. math::

    SSE = \sqrt{ \text{diag} [{(X^TW^{(t)} X)}^{-1} ]}











åˆ†æ•£å‚æ•°çš„ä¼°è®¡
====================================================

è™½ç„¶IRLSç®—æ³•æœ¬èº«å¹¶ä¸åŒ…å«å¯¹åˆ†æ•£å‚æ•°çš„ä¼°è®¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡  Pearson :math:`\mathcal{X}^2` ç»Ÿè®¡æ¥å¾—åˆ° :math:`a(\phi)`
ã€‚

.. math::

    \hat{a}(\phi) = \frac{1}{N-p} \sum_{i=1}^N \frac{ (y_i - \hat{\mu}_i)^2}{\nu(\hat{\mu}_i)}


æˆ–è€…ä½¿ç”¨åå·®ï¼š

.. math::

    \hat{a}(\phi) = \frac{D(y,\hat{\mu})}{N-p}


:math:`N` æ˜¯è§‚æµ‹æ ·æœ¬çš„æ•°é‡ï¼Œ:math:`p` æ˜¯å‚æ•°å‘é‡ :math:`\beta` çš„é•¿åº¦ï¼Œ
:math:`\hat{\mu}_i` æ˜¯ç¬¬næ¡æ ·æœ¬çš„æ¨¡å‹é¢„æµ‹å€¼ï¼Œ
:math:`\hat{a}(\phi)` æœä»è‡ªç”±åº¦ä¸º :math:`n-p` çš„ :math:`\mathcal{X}^2_{n-p}` åˆ†å¸ƒã€‚





æ ‡å‡†è¿æ¥å‡½æ•°
========================================

å½“æ¨¡å‹é‡‡ç”¨è§„èŒƒè¿æ¥å‡½æ•°æ—¶ï¼ŒOIMä¼šé€€åŒ–æˆEIMï¼Œæ­¤æ—¶ç‰›é¡¿æ³•å’ŒIRLSç®—æ³•æ˜¯ç­‰ä»·çš„ã€‚

å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„ä¸€é˜¶å¯¼æ•°(score function)ä¸ºï¼š

.. math::
   :label: eq_glm_estimate_score_2


    \frac{ \partial \ell}{\beta_j} &= \sum_{i=1}^N \left ( \frac{\partial \ell_i}{\partial \theta_i} \right )
    \left ( \frac{\partial \theta_i}{\partial \mu_i} \right )
    \left ( \frac{\partial \mu_i}{\partial \eta_i} \right )
    \left ( \frac{\partial \eta_i}{\partial \beta_j} \right )

    &= \sum_{i=1}^N \left \{ \frac{y_i-b'(\beta_i)}{a(\phi)}   \right \}
    \left \{ \frac{1}{\nu(\mu_i)} \right \} \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{jn}

    &= \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) \nu(\mu_i) } \left ( \frac{\partial \mu}{\partial \eta} \right )_i x_{jn}

æ ¹æ®è§„èŒƒè¿æ¥å‡½æ•°çš„å®šä¹‰ï¼Œå½“æ¨¡å‹é‡‡ç”¨è§„èŒƒè¿æ¥å‡½æ•°æ—¶ï¼Œå°±æœ‰ :math:`\theta=\eta` ã€‚
æ­¤æ—¶ :eq:`eq_glm_estimate_score_2` å°±å¯ä»¥ç®€åŒ–ä¸ºï¼š

.. math::
   :label: eq_glm_estimate_score_3

    \frac{ \partial \ell}{\beta_j}
   &= \sum_{i=1}^N \left ( \frac{\partial \ell_i}{\partial \theta_i} \right )
    \left ( \frac{\partial \theta_i}{\partial \mu_i} \right )
    \left ( \frac{\partial \mu_i}{\partial \eta_i} \right )
    \left ( \frac{\partial \eta_i}{\partial \beta_j} \right )

   &= \sum_{i=1}^N \left ( \frac{\partial \ell_i}{\partial \eta_i} \right )
      \left ( \frac{\partial \eta_i}{\partial \mu_i} \right )
      \left ( \frac{\partial \mu_i}{\partial \eta_i} \right )
      \left ( \frac{\partial \eta_i}{\partial \beta_j} \right )

   &= \sum_{i=1}^N \left ( \frac{\partial \ell_i}{\partial \eta_i} \right )
      \left ( \frac{\partial \eta_i}{\partial \beta_j} \right )


   &= \sum_{i=1}^N \frac{y_i-\mu_i}{a(\phi) } x_{jn}
   = S(\beta_j)


ç°åœ¨æˆ‘ä»¬å¯¹Sç»§ç»­æ±‚å¯¼ï¼Œå¾—åˆ°çš„å°±æ˜¯å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„äºŒé˜¶å¯¼æ•°ï¼Œä¹Ÿç§°ä¸ºè§‚æµ‹ä¿¡æ¯çŸ©é˜µ(observed information matrix)ã€‚

.. math::

   OIM=S(\beta_k)' &= \sum_{i=1}^N  \frac{\partial S_i}{\partial \mu_i}
      \frac{\partial \mu_i}{\partial \eta_i} \frac{\partial \eta_i}{\partial \beta_k}

   &= \sum_{i=1}^N  \frac{-x_{jn}}{a(\phi)} \left ( \frac{\partial \mu_i}{\partial \eta_i} \right )  x_{kn}

   &= -\sum_{i=1}^N  \frac{x_{jn}x_{kn}}{a(\phi)} \left ( \frac{\partial \mu_i}{\partial \eta_i} \right )



OIMä¸­å·²ç»ä¸å†åŒ…å«å˜é‡ :math:`y` ï¼Œæ‰€ä»¥OIMå…³äºå˜é‡ :math:`y` çš„æœŸæœ›ä»ç„¶æ˜¯å®ƒè‡ªå·±ï¼Œæ²¡æœ‰å˜åŒ–ã€‚

.. math::

   EIM = \mathbb{E}_{y}[OIM] = OIM

æœ€ç»ˆæˆ‘ä»¬è¯æ˜å½“GLMä¸­æ¨¡å‹é‡‡ç”¨è§„èŒƒè¿æ¥å‡½æ•°æ˜¯ï¼ŒOIMä¸EIMæ˜¯ç­‰ä»·çš„ã€‚

æ ‡å‡†è¯¯å·®(standard error)
#################################################


ä½†æ˜¯ï¼Œéè§„èŒƒé“¾æ¥ä¼šå¸¦æ¥æ›´é«˜çš„æ ‡å‡†é”™è¯¯(standard error)çš„é—®é¢˜ã€‚
åœ¨å¯¹è§‚æµ‹å€¼ç›¸å¯¹è¾ƒå°‘çš„æ•°æ®é›†è¿›è¡Œå»ºæ¨¡æ—¶ï¼Œ
æˆ‘ä»¬å‘ç°æœ€å¥½åœ¨IRLSç®—æ³•ä¸­è°ƒæ•´æƒé‡ä»¥æ„é€ è§‚æµ‹ä¿¡æ¯çŸ©é˜µ(observed information matrix)OIMæˆ–ä½¿ç”¨MLæ–¹æ³•å¯¹æ•°æ®å»ºæ¨¡ï¼ˆä¹Ÿä½¿ç”¨OIMï¼‰ã€‚
å¦‚æœæ²¡æœ‰è¿›è¡Œä»»ä½•è°ƒæ•´ï¼Œåˆ™å°†åŸºäºï¼ˆ3.66ï¼‰ä¸­ç»™å‡ºçš„EIMç•™ä¸‹é¢„æœŸçš„ä¿¡æ¯çŸ©é˜µï¼ˆEIMï¼‰æ ‡å‡†è¯¯å·®


å½“è®­ç»ƒæ ·æœ¬é›†ç›¸å¯¹è¾ƒå¤§æ—¶ï¼Œä½¿ç”¨EIMäº§ç”Ÿæ ‡å‡†è¯¯å·®å°†ä¸ä¼šå¯¹æ ‡å‡†è¯¯å·®äº§ç”Ÿé‡å¤§å½±å“ã€‚
ç©¶ç«Ÿæœ‰å¤šå¤§å–å†³äºå¤šç§å› ç´ ï¼ŒåŒ…æ‹¬æ¨¡å‹ä¸­é¢„æµ‹å˜é‡çš„æ•°é‡ä»¥åŠæ•°æ®çš„å¹³è¡¡æ–¹å¼ï¼ˆä¾‹å¦‚ï¼ŒäºŒè¿›åˆ¶å“åº”ä¸­1åˆ°0çš„æ¯”è¾ƒæ•°ï¼‰ã€‚
ä½†æ˜¯ï¼Œå³ä½¿å¯¹äºå…·æœ‰è®¸å¤šé¢„æµ‹å˜é‡çš„è¾ƒå°çš„ä¸å¹³è¡¡æ•°æ®é›†ï¼Œæ‰€å¾—çš„æ ‡å‡†è¯¯å·®é€šå¸¸åœ¨ä¸¤ä¸ªä¼°è®¡è¿‡ç¨‹ä¹‹é—´ä¹Ÿä¸ä¼šæœ‰å¤ªå¤§çš„å˜åŒ–ã€‚
ç”±äºæé«˜æ ‡å‡†è¯¯å·®çš„å‡†ç¡®æ€§æ˜¯ç ”ç©¶äººå‘˜çš„å¤´ç­‰å¤§äº‹ï¼Œå› æ­¤ï¼Œå°½å¯èƒ½ä½¿ç”¨OIMä½œä¸ºæ ‡å‡†è¯¯å·®çš„åŸºç¡€æ˜¯å¯å–çš„ã€‚


goodness of fit
#################################################












æˆ‘ä»¬çŸ¥é“ï¼Œæ¨¡å‹çš„å‚æ•°è¶Šå¤šå¯¹æ•°æ®çš„æ‹Ÿåˆç¨‹åº¦å°±è¶Šå¥½ï¼Œæç«¯æƒ…å†µä¸‹ï¼Œæ¨¡å‹å‚æ•°çš„æ•°é‡å’Œæ ·æœ¬çš„æ•°é‡ç›¸åŒï¼Œ
è¿™æ—¶å°±ç›¸å½“äºå¯¹æ¯æ¡æ ·æœ¬éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å‚æ•°(æ¨¡å‹)å»æ‹Ÿåˆå®ƒï¼Œç†è®ºä¸Šå¯ä»¥å®Œç¾æ‹Ÿåˆæ‰€æœ‰çš„æ ·æœ¬ã€‚
æˆ‘ä»¬æŠŠè¿™æ ·çš„æ¨¡å‹æˆä¸ºä¹‹é¥±å’Œæ¨¡å‹(saturated model)ï¼Œä¹Ÿå¯ä»¥ç§°ä¸º
å®Œæ•´æ¨¡å‹(full model)æˆ–è€…æœ€å¤§æ¨¡å‹(maximal model)ã€‚
é¥±å’Œæ¨¡å‹è™½ç„¶èƒ½å®Œç¾æ‹Ÿåˆæ•°æ®é›†ï¼Œä½†å®ƒå¹¶æ²¡æœ‰ä»æ•°æ®é›†ä¸­å­¦ä¹ å‡ºä»»ä½•çš„ç»Ÿè®¡ä¿¡æ¯(ç»Ÿè®¡è§„å¾‹)ï¼Œæ‰€ä¸å…·å¤‡æ³›åŒ–èƒ½åŠ›ï¼Œ
ä¿—ç§°è¿‡æ‹Ÿåˆ(over-fitted)ã€‚
é€šè¿‡ä¸ºé¥±å’Œæ¨¡å‹ä¸­çš„å‚æ•°æ·»åŠ çº¦æŸï¼Œæ¯”å¦‚ä»¤ä¸€äº›å‚æ•°å€¼ä¸º0ï¼Œç›¸å½“äºå»æ‰äº†ä¸€ä¸ªå‚æ•°ï¼Œè¿™æ ·å°±å¾—åˆ°äº†ç®€åŒ–çš„æ¨¡å‹ã€‚
ç®€åŒ–æ¨¡å‹å¯¹æ•°æ®é›†æ‹Ÿåˆåº¦ä¸‹é™äº†ï¼Œä½†æ˜¯å…¶æ³›åŒ–èƒ½åŠ›ä¼šå¾—åˆ°æå‡ï¼Œ
æ›´å°‘çš„å‚æ•°æ•°é‡å¯ä»¥å¾—åˆ°æ›´å¤§çš„æ³›åŒ–èƒ½åŠ›ã€‚
ä½†æ˜¯å‚æ•°æ•°é‡å˜å°‘ï¼Œä¼šé™ä½æ‹Ÿåˆç¨‹åº¦ï¼Œå‚æ•°æ•°é‡è¶Šå°‘æ‹Ÿåˆåº¦å°±è¶Šå·®ï¼Œæ‰€ä»¥ä¹Ÿä¸æ˜¯å‚æ•°è¶Šå°‘è¶Šå¥½ã€‚

åœ¨å¼€å‘ä¸€ä¸ªæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ¨¡å‹çš„é¢„æµ‹å€¼ :math:`\hat{y}` å°½å¯èƒ½çš„æ¥è¿‘æ•°æ®çš„çœŸå®å€¼ :math:`y`
ï¼Œå¯¹äºä¸€ä¸ªè§„æ¨¡ä¸ºNçš„è§‚æµ‹å€¼æ ·æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å‚æ•°æ•°é‡åœ¨ :math:`[1,N]` ä¹‹é—´çš„å€™é€‰æ¨¡å‹ï¼Œ
æœ€ç®€å•çš„æ¨¡å‹æ˜¯åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ¨¡å‹ï¼Œä½†å®ƒå¯¹æ‰€æœ‰çš„æ ·æœ¬çš„é¢„æµ‹å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œç¼ºä¹æ‹Ÿåˆèƒ½åŠ›ã€‚
æœ€å¤æ‚çš„æ¨¡å‹æ˜¯å«æœ‰Nä¸ªå‚æ•°çš„æ¨¡å‹ï¼Œå®ƒå¯ä»¥å®Œç¾æ‹Ÿåˆæ‰€æœ‰æ ·æœ¬ï¼Œä½†æ˜¯å®ƒç¼ºä¹æ³›åŒ–èƒ½åŠ›ã€‚
ç†è®ºä¸Šï¼Œæˆ‘ä»¬æœŸæœ›å¾—åˆ°ä¸€ä¸ªå‚æ•°æ•°é‡å°½å¯èƒ½å°‘ï¼Œåˆèƒ½ä¿æŒæ‹Ÿåˆèƒ½åŠ›çš„æ¨¡å‹ã€‚


åœ¨ç»Ÿè®¡å­¦ä¸­ï¼Œä¼¼ç„¶æ¯”æ£€éªŒ(likelihood-ratio test,LRT)ç”¨æ¥å¯¹æ¯”ä¸¤ä¸ªæ¨¡å‹å¯¹äºå½“å‰æ•°æ®é›†çš„æ‹Ÿåˆç¨‹åº¦ï¼Œ
å…¶æ˜¯åˆ©ç”¨ä¼¼ç„¶æ¯”(likelihood-ratio LR)çš„å€¼æ¥æ¯”è¾ƒä¸¤ä¸ªæ¨¡å‹çš„ä¼˜åŠ£ã€‚
LRTçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š


.. math::

    LR = 2 \ln \frac{L1}{L2} = 2 (\ln L1-\ln L2)

å…¶ä¸­L1ä¸ºå¤æ‚æ¨¡å‹æœ€å¤§ä¼¼ç„¶å€¼ï¼ŒL2ä¸ºç®€å•æ¨¡å‹æœ€å¤§ä¼¼ç„¶å€¼ã€‚
ä»å…¬å¼å¯ä»¥çœ‹å‡ºï¼Œä¼¼ç„¶æ¯”å°±æ˜¯ä¸¤ä¸ªæ¨¡å‹çš„ä¼¼ç„¶å€¼ä¹‹æ¯”çš„å¯¹æ•°ï¼Œä¹Ÿå¯ä»¥çœ‹æˆæ˜¯ä¸¤ä¸ªæ¨¡å‹å¯¹æ•°ä¼¼ç„¶å€¼çš„å·®å€¼ã€‚
ä¼¼ç„¶(likelihood)ï¼Œå®é™…ä¸Šä¹Ÿå¯ä»¥ç¿»è¯‘ä¸ºå¯èƒ½æ€§ï¼Œè¡¨ç¤ºçš„æ˜¯æ ·æœ¬å‘ç”Ÿçš„æ¦‚ç‡ï¼Œæ˜¾ç„¶ä¼¼ç„¶å€¼è¶Šå¤§çš„æ¨¡å‹å¯¹æ•°æ®çš„æ‹Ÿåˆä¹Ÿå°±è¶Šå¥½ã€‚
ä¼¼ç„¶æ¯”å°±æ˜¯ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªæ¨¡å‹çš„ä¼¼ç„¶å€¼å¤§å°ã€‚
ä½†æ˜¯å¹¶ä¸æ˜¯ä»»æ„ä¸¤ä¸ªæ¨¡å‹éƒ½å¯ä»¥åº”ç”¨ä¼¼ç„¶æ¯”å»æ¯”è¾ƒï¼Œåªæœ‰åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ä¼¼ç„¶æ¯”æ‰æœ‰æ„ä¹‰ã€‚

1. ä¸¤ä¸ªæ¨¡å‹é‡‡ç”¨åŒä¸€ä»½æ•°æ®é›†ï¼Œæ ·æœ¬çš„æ•°é‡å’Œç‰¹å¾éƒ½æ˜¯ç›¸åŒçš„ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œä¸åŒæ•°æ®é›†ä¼¼ç„¶å€¼è‡ªç„¶æ˜¯ä¸åŒçš„ï¼Œæ²¡æœ‰æ¯”è¾ƒçš„æ„ä¹‰ã€‚
2. ä¸¤ä¸ªæ¨¡å‹æ˜¯åµŒå¥—å…³ç³»(nested)ã€‚æ‰€è°“åµŒå¥—å…³ç³»å°±æ˜¯ï¼Œå…¶ä¸­ä¸€ä¸ªæ¨¡å‹æ˜¯é€šè¿‡æŠŠå¦ä¸€ä¸ªæ¨¡å‹ä¸­çš„éƒ¨åˆ†å‚æ•°è®¾ç½®ä¸º0è€Œå¾—åˆ°çš„ã€‚


å½“æ ·æœ¬è¶³å¤Ÿå¤§æ—¶ï¼Œä¼¼ç„¶æ¯”æ˜¯æ¸è¿›æœä»å¡æ–¹åˆ†å¸ƒçš„ï¼Œå…¶è‡ªç”±åº¦ç­‰äºä¸¤ä¸ªæ¨¡å‹çš„å‚æ•°æ•°é‡ä¹‹å·®(å‚æ•°å€¼ä¸º0çš„å‚æ•°çš„æ•°é‡)ã€‚
è¿™æ ·æ ¹æ®å¡æ–¹åˆ†å¸ƒä¸´ç•Œå€¼è¡¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­æ¨¡å‹å·®å¼‚æ˜¯å¦æ˜¾è‘—ã€‚












åœ¨GLMä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¯„ä¼°æ¨¡å‹æ‹Ÿåˆä¼˜åº¦(Goodness of fit)çš„æŒ‡æ ‡ï¼Œç§°ä¹‹ä¸ºåå·®(deviance)ã€‚
**åå·®çš„è®¡ç®—æ–¹æ³•å°±æ˜¯é¥±å’Œæ¨¡å‹å’Œæ‹Ÿåˆæ¨¡å‹ä¹‹é—´çš„ä¼¼ç„¶æ¯”ã€‚**
æˆ‘ä»¬ç”¨ç¬¦å· :math:`L_m` è¡¨ç¤ºæˆ‘ä»¬æ‹Ÿåˆå‡ºçš„ç›®æ ‡æ¨¡å‹çš„ä¼¼ç„¶å€¼ï¼Œ
ç”¨ç¬¦å· :math:`L_f` è¡¨ç¤ºé¥±å’Œæ¨¡å‹çš„ä¼¼ç„¶å€¼ã€‚
ç”¨ç¬¦å· :math:`D` è¡¨ç¤ºåå·®ï¼Œå…¶é€šè¿‡ä¸‹å¼ç»™å‡ºï¼š


.. math::
    :label: eq_34_50

    D = 2 (\ln L_f -\ln L_m)


æˆ‘ä»¬çŸ¥é“åœ¨GLMä¸­ï¼Œæ¨¡å‹çš„é¢„æµ‹å€¼ :math:`\hat{y}` å°±æ˜¯åˆ†å¸ƒ :math:`p(y|x)` çš„æœŸæœ›å€¼
:math:`\mathbb{E}[p(y|x)]=\hat{\mu}` ï¼Œå³ :math:`\hat{y}=\hat{\mu}` ã€‚
æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç”¨ :math:`\hat{\mu}` è¡¨ç¤ºæ¨¡å‹çš„é¢„æµ‹å€¼ã€‚
å¹¶ä¸”æˆ‘ä»¬çŸ¥é“ï¼ŒæŒ‡æ•°æ—å½¢å¼çš„è‡ªç„¶å‚æ•° :math:`\theta` å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå…³äºå‡å€¼å‚æ•° :math:`\mu` çš„å‡½æ•°ï¼Œ
å› æ­¤ï¼Œåœ¨GLMæ¡†æ¶ä¸‹ï¼Œç›®æ ‡æ¨¡å‹çš„ä¼¼ç„¶å€¼ä¸ºï¼š


.. math::
    :label: eq_34_51

    L_m = \exp \left \{  \sum_{i=1}^N \frac{y_i \theta(\hat{\mu}_i) -b(\theta(\hat{\mu}_i))}{a(\phi)}
    + \sum_{i=1}^N  c(y_i;\phi) \right \}



å¯¹äºé¥±å’Œæ¨¡å‹ï¼Œæ¯æ¡æ ·æœ¬çš„é¢„æµ‹å€¼å°±æ˜¯æ ·æœ¬çš„çœŸå®å€¼ï¼Œå³ :math:`\hat{y_i}=y_i` ï¼Œæ¢å¥è¯è¯´ï¼Œ
å¯¹äºé¥±å’Œæ¨¡å‹ï¼Œæ»¡è¶³ :math:`\hat{y_i}=\hat{\mu}_i=y_i`
ã€‚å› æ­¤ï¼Œé¥±å’Œæ¨¡å‹çš„ä¼¼ç„¶å€¼ä¸ºï¼š


.. math::
    :label: eq_34_52

    L_f = \exp \left \{  \sum_{i=1}^N \frac{y_i \theta(y_i) -b(\theta(y_i))}{a(\phi)}
    + \sum_{i=1}^N  c(y_i;\phi) \right \}


æŠŠ :eq:`eq_34_51` å’Œ :eq:`eq_34_52` ä»£å…¥åˆ° :eq:`eq_34_50`
å¯å¾—åˆ°GLMçš„åå·®ï¼š


.. math::

    D &= 2 (\ln L_f -\ln L_m)

    &= \frac{2}{a(\phi)} \sum_{i=1}^N  [ y_i \{ \theta(y_i) - \theta(\hat{\mu}_i) \} - b\{\theta(y_i)\} + b\{\theta(\hat{\mu}_i)\} ]

    &\triangleq 2 \sum_{i=1}^N  [ y_i \{ \theta(y_i) - \theta(\hat{\mu}_i) \} - b\{\theta(y_i)\} + b\{\theta(\hat{\mu}_i)\} ]


ç”±äº :math:`a(\phi)` ä¸æ ·æœ¬å’Œå‚æ•°éƒ½æ— å…³ï¼Œæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œæ‰€ä»¥é€šå¸¸ä¼šè¢«çœç•¥æ‰ã€‚
å¯¹äºä¸€ä¸ªç‰¹å®šçš„æ ·æœ¬é›†å’Œæ¨¡å‹ï¼Œé¥±å’Œæ¨¡å‹çš„ä¼¼ç„¶å€¼æ˜¯ä¸€ä¸ªå¸¸æ•°å€¼ï¼Œ
å› æ­¤
**æœ€å¤§åŒ–ä¼¼ç„¶å‡½æ•°å’Œæœ€å°åŒ–åå·®æ˜¯ç­‰ä»·çš„**
**ï¼Œåœ¨è¿›è¡Œå‚æ•°å­¦ä¹ æ—¶å¯ä»¥ç”¨æœ€å°åŒ–åå·®æ›¿ä»£æœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°ã€‚**


åœ¨ç»Ÿè®¡ä¸­ï¼Œåå·®(deviance)æ˜¯ç»Ÿè®¡æ¨¡å‹çš„æ‹Ÿåˆä¼˜åº¦ç»Ÿè®¡ï¼›
å®ƒé€šå¸¸ç”¨äºç»Ÿè®¡å‡è®¾æ£€éªŒã€‚
å®ƒæ˜¯å°†æ™®é€šæœ€å°äºŒä¹˜ä¸­çš„æ®‹å·®å¹³æ–¹å’Œç”¨äºé€šè¿‡æœ€å¤§ä¼¼ç„¶å®ç°æ¨¡å‹æ‹Ÿåˆçš„æƒ…å†µçš„æ¦‚æ‹¬ã€‚
å®ƒåœ¨æŒ‡æ•°å¼¥æ•£æ¨¡å‹å’Œå¹¿ä¹‰çº¿æ€§æ¨¡å‹ä¸­èµ·ç€é‡è¦ä½œç”¨ã€‚


https://newonlinecourses.science.psu.edu/stat504/node/220/


https://en.wikipedia.org/wiki/Deviance_(statistics)


https://www.xiaofandajie.top/2018/03/06/%E6%9E%81%E5%A4%A7%E4%BC%BC%E7%84%B6%E6%B3%95%E4%B8%8Elogistic%E5%9B%9E%E5%BD%92/

https://bookdown.org/hezhijian/book/est.html#section-30



